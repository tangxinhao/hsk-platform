import{_ as Z,u as h,r as u,a as N,i as ee,b as s,G as le,o as b,c as z,d as y,e as t,w as a,j as x,E as c,g as i,J as j,K as I,N as te,L as ae,t as g,I as oe}from"./index-e5bf8409.js";const ne={class:"exam-sets-container"},se={class:"page-header"},ie={class:"pagination"},re={__name:"ExamSetsPage",setup(ue){const M=h(),V=u(!1),S=u([]),E=u(0),$=u(1),q=u(10),p=N({level:null}),f=u(!1),v=u("create"),k=u(null),C=u(!1),n=N({title:"",level:1,time_limit:60,description:"",question_count:0}),R={title:[{required:!0,message:"请输入套卷名称",trigger:"blur"}],level:[{required:!0,message:"请选择等级",trigger:"change"}],time_limit:[{required:!0,message:"请设置时间限制",trigger:"blur"}]},d=async()=>{V.value=!0;try{const o={page_size:1e4};p.level&&(o.level=p.level);const e=await x.getExamSets(o);console.log("套卷API响应:",e.data);const r=e.data.results||e.data||[];S.value=r,E.value=e.data.count||r.length||0,console.log(`成功加载 ${S.value.length} 个套卷`)}catch(o){console.error("加载套卷失败:",o),console.error("错误详情:",o.response),c.error(`加载套卷失败: ${o.message}`)}finally{V.value=!1}},L=()=>{p.level=null,d()},D=(o,e=null)=>{v.value=o,o==="create"?Object.assign(n,{title:"",level:1,time_limit:60,description:"",question_count:0}):Object.assign(n,{id:e.id,title:e.title,level:e.level,time_limit:e.time_limit,description:e.description,question_count:e.question_count}),f.value=!0},T=async()=>{if(k.value)try{await k.value.validate(),C.value=!0,v.value==="create"?(await x.createExamSet(n),c.success("创建成功")):(await x.updateExamSet(n.id,n),c.success("保存成功")),f.value=!1,d()}catch(o){console.error("操作失败:",o),c.error(v.value==="create"?"创建失败":"保存失败")}finally{C.value=!1}},A=async o=>{try{await oe.confirm(`确定要删除套卷"${o.title}"吗？删除后无法恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.deleteExamSet(o.id),c.success("删除成功"),d()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),c.error("删除失败"))}},F=o=>{M.push(`/questions?exam_set_id=${o.id}`)},O=o=>o?new Date(o).toLocaleString("zh-CN"):"-";return ee(()=>{d()}),(o,e)=>{const r=s("el-button"),w=s("el-option"),U=s("el-select"),_=s("el-form-item"),B=s("el-form"),P=s("el-card"),m=s("el-table-column"),G=s("el-tag"),J=s("el-table"),Q=s("el-pagination"),K=s("el-input"),W=s("el-input-number"),X=s("el-dialog"),Y=le("loading");return b(),z("div",ne,[y("div",se,[e[11]||(e[11]=y("h2",null,"考试套卷管理",-1)),t(r,{type:"primary",icon:"Plus",onClick:e[0]||(e[0]=l=>D("create"))},{default:a(()=>e[10]||(e[10]=[i(" 创建新套卷 ")])),_:1,__:[10]})]),t(P,{class:"filter-card"},{default:a(()=>[t(B,{inline:!0,model:p},{default:a(()=>[t(_,{label:"等级"},{default:a(()=>[t(U,{modelValue:p.level,"onUpdate:modelValue":e[1]||(e[1]=l=>p.level=l),placeholder:"全部等级",clearable:""},{default:a(()=>[t(w,{label:"全部",value:null}),(b(),z(j,null,I(6,l=>t(w,{key:l,label:`HSK${l}`,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(_,null,{default:a(()=>[t(r,{type:"primary",onClick:d},{default:a(()=>e[12]||(e[12]=[i("查询")])),_:1,__:[12]}),t(r,{onClick:L},{default:a(()=>e[13]||(e[13]=[i("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),_:1}),t(P,{class:"table-card"},{default:a(()=>[te((b(),ae(J,{data:S.value,style:{width:"100%"},stripe:""},{default:a(()=>[t(m,{prop:"id",label:"ID",width:"80"}),t(m,{prop:"title",label:"套卷名称","min-width":"200"}),t(m,{label:"等级",width:"100"},{default:a(({row:l})=>[t(G,{type:"warning"},{default:a(()=>[i("HSK"+g(l.level),1)]),_:2},1024)]),_:1}),t(m,{prop:"question_count",label:"题目数量",width:"120"},{default:a(({row:l})=>[i(g(l.question_count||0)+" 题 ",1)]),_:1}),t(m,{prop:"time_limit",label:"时间限制",width:"120"},{default:a(({row:l})=>[i(g(l.time_limit)+" 分钟 ",1)]),_:1}),t(m,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[i(g(O(l.created_at)),1)]),_:1}),t(m,{label:"操作",width:"250",fixed:"right"},{default:a(({row:l})=>[t(r,{size:"small",type:"primary",onClick:H=>D("edit",l)},{default:a(()=>e[14]||(e[14]=[i(" 编辑 ")])),_:2,__:[14]},1032,["onClick"]),t(r,{size:"small",type:"info",onClick:H=>F(l)},{default:a(()=>e[15]||(e[15]=[i(" 管理题目 ")])),_:2,__:[15]},1032,["onClick"]),t(r,{size:"small",type:"danger",onClick:H=>A(l)},{default:a(()=>e[16]||(e[16]=[i(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,V.value]]),y("div",ie,[t(Q,{"current-page":$.value,"onUpdate:currentPage":e[2]||(e[2]=l=>$.value=l),"page-size":q.value,"onUpdate:pageSize":e[3]||(e[3]=l=>q.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:E.value,onCurrentChange:d,onSizeChange:d},null,8,["current-page","page-size","total"])])]),_:1}),t(X,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=l=>f.value=l),title:v.value==="create"?"创建考试套卷":"编辑考试套卷",width:"600px"},{footer:a(()=>[t(r,{onClick:e[8]||(e[8]=l=>f.value=!1)},{default:a(()=>e[18]||(e[18]=[i("取消")])),_:1,__:[18]}),t(r,{type:"primary",onClick:T,loading:C.value},{default:a(()=>[i(g(v.value==="create"?"创建":"保存"),1)]),_:1},8,["loading"])]),default:a(()=>[t(B,{model:n,rules:R,ref_key:"formRef",ref:k,"label-width":"100px"},{default:a(()=>[t(_,{label:"套卷名称",prop:"title"},{default:a(()=>[t(K,{modelValue:n.title,"onUpdate:modelValue":e[4]||(e[4]=l=>n.title=l),placeholder:"例如：HSK3模拟试卷A"},null,8,["modelValue"])]),_:1}),t(_,{label:"等级",prop:"level"},{default:a(()=>[t(U,{modelValue:n.level,"onUpdate:modelValue":e[5]||(e[5]=l=>n.level=l),placeholder:"请选择HSK等级"},{default:a(()=>[(b(),z(j,null,I(6,l=>t(w,{key:l,label:`HSK${l}`,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"时间限制",prop:"time_limit"},{default:a(()=>[t(W,{modelValue:n.time_limit,"onUpdate:modelValue":e[6]||(e[6]=l=>n.time_limit=l),min:30,max:180,step:10},null,8,["modelValue"]),e[17]||(e[17]=y("span",{style:{"margin-left":"10px"}},"分钟",-1))]),_:1,__:[17]}),t(_,{label:"描述",prop:"description"},{default:a(()=>[t(K,{modelValue:n.description,"onUpdate:modelValue":e[7]||(e[7]=l=>n.description=l),type:"textarea",rows:4,placeholder:"请输入套卷描述信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},me=Z(re,[["__scopeId","data-v-4202b845"]]);export{me as default};
