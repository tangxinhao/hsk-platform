import{_ as re,u as ue,O as de,r as L,a as pe,i as _e,b as _,G as ce,o as p,c,d,e as l,w as o,k as h,N as me,E as m,h as R,g as v,Y as fe,J as A,K as E,Z as ge,t as C,$ as ve,M as K,q as ye,a0 as be,L as G,A as Ve,y as T}from"./index-e5bf8409.js";const he={class:"edit-page"},we={class:"page-header"},ke={class:"edit-container"},Ue={class:"audio-upload-box"},xe={class:"upload-actions"},Ce={key:0,class:"audio-status"},Le={key:0,class:"audio-preview"},Se=["src"],$e={class:"audio-info"},De={class:"card-header"},Re={class:"questions-list"},Ae={class:"question-title"},Ee={class:"question-number"},Ge={class:"question-preview"},Me={class:"options-editor"},Ne={class:"option-header"},Be={class:"option-label"},Oe={key:0},Pe={key:1},Ke=["src"],Te={key:2,class:"mixed-option"},Fe=["src"],He={class:"form-actions"},je={__name:"ListeningGroupEditPage",setup(ze){const z=ue(),J=de(),M=L(!1),N=L(!1),k=L(!1),y=L(0),B=L(null),F=L("0"),a=pe({material_group:"",title:"",level:1,play_times:2,audio_url:"",audio_duration:0,questions:[]}),Q={title:[{required:!0,message:"è¯·è¾“å…¥ææ–™æ ‡é¢˜",trigger:"blur"}]},Y=async()=>{var e,t;const r=J.params.id;if(!r){m.error("ç¼ºå°‘é¢˜ç»„ID"),S();return}M.value=!0;try{R.defaults.baseURL||(R.defaults.baseURL="/api"),console.log("åŠ è½½é¢˜ç»„æ•°æ®:",r);const i=(await R.get(`/question/listening-group/${r}/`)).data;console.log("é¢˜ç»„æ•°æ®:",i),a.material_group=r,a.title=i.material.title,a.level=i.material.level,a.play_times=i.material.play_times,a.audio_url=i.material.audio_url,a.audio_duration=i.material.audio_duration||0,i.material.audio_url&&(y.value=i.material.audio_duration||0,console.log("åŸéŸ³é¢‘URL:",a.audio_url,"æ—¶é•¿:",y.value)),a.questions=i.questions.map(f=>{let U=[],$="text";try{const g=JSON.parse(f.options);g.option_type?($=g.option_type,U=g.options||[]):Array.isArray(g)&&(U=g.map((b,D)=>({label:String.fromCharCode(65+D),text:typeof b=="string"?b:b.text||b.label,value:String.fromCharCode(65+D)})))}catch(g){console.error("è§£æé€‰é¡¹å¤±è´¥:",g)}return{id:f.id,content:f.content,type:f.type||"single",difficulty:f.difficulty||2,option_type:$,options:U,answer:f.answer,explanation:f.explanation||""}}),m.success("é¢˜ç»„æ•°æ®åŠ è½½æˆåŠŸ")}catch(n){console.error("åŠ è½½é¢˜ç»„å¤±è´¥:",n),m.error("åŠ è½½é¢˜ç»„æ•°æ®å¤±è´¥: "+(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.error)||n.message))}finally{M.value=!1}},Z=r=>{const e=new FileReader;return k.value=!0,e.onload=t=>{a.audio_url=t.target.result;const n=new Audio(t.target.result);n.addEventListener("loadedmetadata",()=>{y.value=Math.round(n.duration),a.audio_duration=y.value,k.value=!1,m.success(`éŸ³é¢‘æ›´æ¢æˆåŠŸï¼Œæ—¶é•¿ï¼š${O(y.value)}`)}),n.addEventListener("error",()=>{k.value=!1,m.error("éŸ³é¢‘åŠ è½½å¤±è´¥")})},e.onerror=()=>{k.value=!1,m.error("éŸ³é¢‘æ–‡ä»¶è¯»å–å¤±è´¥")},e.readAsDataURL(r),!1},W=()=>{B.value&&y.value===0&&(y.value=Math.round(B.value.duration))},H=(r,e,t)=>{const n=new FileReader;return n.onload=i=>{a.questions[e].options[t].image=i.target.result,m.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ")},n.onerror=()=>{m.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥")},n.readAsDataURL(r),!1},X=r=>{const e=a.questions[r],t=String.fromCharCode(65+e.options.length);e.options.push({label:t,text:"",value:t,image:""})},I=(r,e)=>{if(a.questions[r].options.length<=2){m.warning("è‡³å°‘ä¿ç•™2ä¸ªé€‰é¡¹");return}a.questions[r].options.splice(e,1)},q=async()=>{var r,e;if(!a.audio_url){m.warning("éŸ³é¢‘æ–‡ä»¶ä¸¢å¤±ï¼Œè¯·é‡æ–°ä¸Šä¼ ");return}if(a.questions.length===0){m.warning("è‡³å°‘æ·»åŠ ä¸€é“é¢˜ç›®");return}for(let t=0;t<a.questions.length;t++)if(!a.questions[t].answer){m.warning(`ç¬¬${t+1}é¢˜ç¼ºå°‘æ­£ç¡®ç­”æ¡ˆ`);return}N.value=!0;try{const t={material:{title:a.title,level:a.level,play_times:a.play_times,audio_url:a.audio_url,audio_duration:y.value||a.audio_duration},questions:a.questions.map((n,i)=>({id:n.id||null,content:n.content,type:n.type,difficulty:n.difficulty,answer:n.answer,explanation:n.explanation,question_number:i+1,options:{option_type:n.option_type,options:n.options}}))};console.log("æäº¤æ›´æ–°æ•°æ®:",t),await R.put(`/question/listening-group/${a.material_group}/`,t),m.success("ä¿å­˜æˆåŠŸï¼"),setTimeout(()=>{S()},1e3)}catch(t){console.error("ä¿å­˜å¤±è´¥:",t),m.error("ä¿å­˜å¤±è´¥: "+(((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.error)||t.message))}finally{N.value=!1}},O=r=>{if(!r)return"0ç§’";const e=Math.floor(r/60),t=r%60;return e>0?`${e}åˆ†${t}ç§’`:`${t}ç§’`},ee=r=>({single:"å•é€‰é¢˜",judge:"åˆ¤æ–­é¢˜",multiple:"å¤šé€‰é¢˜"})[r]||"å•é€‰é¢˜",S=()=>{z.push("/listening-groups")};return _e(()=>{Y()}),(r,e)=>{const t=_("el-button"),n=_("el-input"),i=_("el-form-item"),f=_("el-option"),U=_("el-select"),$=_("el-input-number"),g=_("el-upload"),b=_("el-icon"),D=_("el-alert"),j=_("el-card"),le=_("el-tag"),oe=_("el-rate"),P=_("el-radio"),ae=_("el-radio-group"),te=_("el-collapse-item"),se=_("el-collapse"),ne=_("el-form"),ie=ce("loading");return p(),c("div",he,[d("div",we,[l(t,{onClick:S,icon:h(fe)},{default:o(()=>e[4]||(e[4]=[v("è¿”å›")])),_:1,__:[4]},8,["icon"]),e[5]||(e[5]=d("h2",null,"ç¼–è¾‘å¬åŠ›é¢˜ç»„",-1))]),me((p(),c("div",ke,[l(ne,{ref:"formRef",model:a,"label-width":"120px",rules:Q},{default:o(()=>[l(j,{class:"section-card",shadow:"never"},{header:o(()=>e[6]||(e[6]=[d("div",{class:"card-header"},[d("span",null,"ğŸ“ éŸ³é¢‘ææ–™ä¿¡æ¯")],-1)])),default:o(()=>[l(i,{label:"ææ–™æ ‡é¢˜",prop:"title"},{default:o(()=>[l(n,{modelValue:a.title,"onUpdate:modelValue":e[0]||(e[0]=s=>a.title=s),placeholder:"ä¾‹å¦‚ï¼šHSK1å¬åŠ›ç¬¬å››éƒ¨åˆ†ç¬¬11-15é¢˜å¯¹è¯"},null,8,["modelValue"])]),_:1}),l(i,{label:"HSKç­‰çº§",prop:"level"},{default:o(()=>[l(U,{modelValue:a.level,"onUpdate:modelValue":e[1]||(e[1]=s=>a.level=s),placeholder:"è¯·é€‰æ‹©"},{default:o(()=>[(p(),c(A,null,E(6,s=>l(f,{label:`HSK ${s}çº§`,value:s,key:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"æ’­æ”¾æ¬¡æ•°",prop:"play_times"},{default:o(()=>[l($,{modelValue:a.play_times,"onUpdate:modelValue":e[2]||(e[2]=s=>a.play_times=s),min:1,max:3},null,8,["modelValue"]),e[7]||(e[7]=d("span",{style:{"margin-left":"10px",color:"#909399"}},"å¬åŠ›è€ƒè¯•æ—¶éŸ³é¢‘æ’­æ”¾æ¬¡æ•°",-1))]),_:1,__:[7]}),l(i,{label:"éŸ³é¢‘æ–‡ä»¶"},{default:o(()=>[d("div",Ue,[d("div",xe,[l(g,{class:"audio-uploader","show-file-list":!1,"before-upload":Z,accept:"audio/*",disabled:k.value},{default:o(()=>[l(t,{icon:h(ge),loading:k.value,type:"primary",plain:""},{default:o(()=>[v(C(k.value?"ä¸Šä¼ ä¸­...":"æ›´æ¢éŸ³é¢‘ï¼ˆå¯é€‰ï¼‰"),1)]),_:1},8,["icon","loading"])]),_:1},8,["disabled"]),a.audio_url?(p(),c("span",Ce,[l(b,{color:"#67c23a"},{default:o(()=>[l(h(ve))]),_:1}),e[8]||(e[8]=v(" åŸéŸ³é¢‘å·²ä¿å­˜ "))])):K("",!0)]),a.audio_url?(p(),c("div",Le,[d("audio",{ref_key:"audioPlayer",ref:B,src:a.audio_url,controls:"",style:{width:"100%"},onLoadedmetadata:W,crossorigin:"anonymous"}," æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ ",40,Se),d("p",$e,[l(b,null,{default:o(()=>[l(h(ye))]),_:1}),v(" éŸ³é¢‘æ—¶é•¿: "+C(y.value>0?O(y.value):O(a.audio_duration)),1)])])):K("",!0),l(D,{title:"ğŸ’¡ åŸéŸ³é¢‘å·²ä¿å­˜ï¼Œå¦‚ä¸éœ€è¦æ›´æ¢è¯·ç›´æ¥ç¼–è¾‘é¢˜ç›®åä¿å­˜",type:"info",closable:!1,"show-icon":"",style:{"margin-top":"10px"}})])]),_:1})]),_:1}),l(j,{class:"section-card",shadow:"never"},{header:o(()=>[d("div",De,[d("span",null,"ğŸ“‹ é¢˜ç›®åˆ—è¡¨ (å…±"+C(a.questions.length)+"é¢˜)",1)])]),default:o(()=>[d("div",Re,[l(se,{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=s=>F.value=s),accordion:""},{default:o(()=>[(p(!0),c(A,null,E(a.questions,(s,x)=>(p(),G(te,{key:x,name:String(x)},{title:o(()=>[d("div",Ae,[d("span",Ee,"ç¬¬"+C(x+1)+"é¢˜",1),l(le,{size:"small"},{default:o(()=>[v(C(ee(s.type)),1)]),_:2},1024),d("span",Ge,C(s.content),1)])]),default:o(()=>[l(i,{label:"é¢˜ç›®å†…å®¹"},{default:o(()=>[l(n,{modelValue:s.content,"onUpdate:modelValue":u=>s.content=u,type:"textarea",rows:2,placeholder:"è¯·è¾“å…¥é¢˜ç›®å†…å®¹"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{label:"é¢˜ç›®ç±»å‹"},{default:o(()=>[l(U,{modelValue:s.type,"onUpdate:modelValue":u=>s.type=u,placeholder:"è¯·é€‰æ‹©"},{default:o(()=>[l(f,{label:"å•é€‰é¢˜",value:"single"}),l(f,{label:"åˆ¤æ–­é¢˜",value:"judge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{label:"éš¾åº¦"},{default:o(()=>[l(oe,{modelValue:s.difficulty,"onUpdate:modelValue":u=>s.difficulty=u,max:5,"show-score":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{label:"é€‰é¡¹ç±»å‹"},{default:o(()=>[l(ae,{modelValue:s.option_type,"onUpdate:modelValue":u=>s.option_type=u},{default:o(()=>[l(P,{value:"text"},{default:o(()=>e[9]||(e[9]=[v("çº¯æ–‡å­—")])),_:1,__:[9]}),l(P,{value:"image"},{default:o(()=>e[10]||(e[10]=[v("çº¯å›¾ç‰‡")])),_:1,__:[10]}),l(P,{value:"mixed"},{default:o(()=>e[11]||(e[11]=[v("å›¾æ–‡æ··åˆ")])),_:1,__:[11]})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{label:"é€‰é¡¹"},{default:o(()=>[d("div",Me,[(p(!0),c(A,null,E(s.options,(u,V)=>(p(),c("div",{key:V,class:"option-edit-card"},[d("div",Ne,[d("span",Be,C(String.fromCharCode(65+V)),1),l(t,{type:"danger",icon:h(Ve),circle:"",size:"small",onClick:w=>I(x,V)},null,8,["icon","onClick"])]),s.option_type==="text"?(p(),c("div",Oe,[l(n,{modelValue:u.text,"onUpdate:modelValue":w=>u.text=w,placeholder:"è¯·è¾“å…¥é€‰é¡¹æ–‡å­—"},null,8,["modelValue","onUpdate:modelValue"])])):s.option_type==="image"?(p(),c("div",Pe,[l(g,{class:"image-uploader","show-file-list":!1,"before-upload":w=>H(w,x,V),accept:"image/*"},{default:o(()=>[u.image?(p(),c("img",{key:0,src:u.image,class:"option-image"},null,8,Ke)):(p(),G(b,{key:1,class:"uploader-icon"},{default:o(()=>[l(h(T))]),_:1}))]),_:2},1032,["before-upload"])])):s.option_type==="mixed"?(p(),c("div",Te,[l(g,{class:"image-uploader small","show-file-list":!1,"before-upload":w=>H(w,x,V),accept:"image/*"},{default:o(()=>[u.image?(p(),c("img",{key:0,src:u.image,class:"option-image-small"},null,8,Fe)):(p(),G(b,{key:1,class:"uploader-icon-small"},{default:o(()=>[l(h(T))]),_:1}))]),_:2},1032,["before-upload"]),l(n,{modelValue:u.text,"onUpdate:modelValue":w=>u.text=w,placeholder:"è¯·è¾“å…¥é€‰é¡¹æ–‡å­—",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"])])):K("",!0)]))),128)),l(t,{type:"primary",icon:h(T),onClick:u=>X(x),style:{width:"100%","margin-top":"10px"}},{default:o(()=>e[12]||(e[12]=[v(" æ·»åŠ é€‰é¡¹ ")])),_:2,__:[12]},1032,["icon","onClick"])])]),_:2},1024),l(i,{label:"æ­£ç¡®ç­”æ¡ˆ"},{default:o(()=>[l(U,{modelValue:s.answer,"onUpdate:modelValue":u=>s.answer=u,placeholder:"è¯·é€‰æ‹©"},{default:o(()=>[(p(!0),c(A,null,E(s.options,(u,V)=>(p(),G(f,{key:V,label:String.fromCharCode(65+V),value:String.fromCharCode(65+V)},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{label:"ç­”æ¡ˆè§£æ"},{default:o(()=>[l(n,{modelValue:s.explanation,"onUpdate:modelValue":u=>s.explanation=u,type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ç­”æ¡ˆè§£æï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])]),_:1}),d("div",He,[l(t,{onClick:S},{default:o(()=>e[13]||(e[13]=[v("å–æ¶ˆ")])),_:1,__:[13]}),l(t,{type:"primary",onClick:q,loading:N.value},{default:o(()=>[l(b,null,{default:o(()=>[l(h(be))]),_:1}),e[14]||(e[14]=v(" ä¿å­˜ä¿®æ”¹ "))]),_:1,__:[14]},8,["loading"])])]),_:1},8,["model"])])),[[ie,M.value]])])}}},Qe=re(je,[["__scopeId","data-v-bbe6d9f4"]]);export{Qe as default};
