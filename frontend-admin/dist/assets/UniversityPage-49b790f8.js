import{_ as H,j as w,b as g,G as P,o,c as b,d as v,e as l,w as s,N as q,L as h,g as u,J as S,K as z,t as F}from"./index-e5bf8409.js";function Y(r){if(!r)return"暂无数据";try{const e=new Date(r);return isNaN(e.getTime())?"日期格式无效":e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(e){return console.error("日期格式化错误:",e),"日期格式化错误"}}const A={name:"UniversityPage",data(){return{universities:[],filteredUniversities:[],loading:!1,submitLoading:!1,dialogVisible:!1,dialogTitle:"添加高校",isEditing:!1,universityForm:{name:"",englishName:"",region:"",establishYear:new Date().getFullYear(),website:"",ranking:1,min_hsk_level:5,tuition_fee:null,language_requirements:"",scholarship:"",is985:!1,is211:!1,isDoubleFirstClass:!1,description:""},rules:{name:[{required:!0,message:"请输入高校名称",trigger:"blur"}],englishName:[{required:!0,message:"请输入英文名称",trigger:"blur"}],region:[{required:!0,message:"请选择所在地区",trigger:"change"}],website:[{required:!0,message:"请输入官网地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]},regions:["北京","上海","广东","江苏","浙江","四川","湖北","湖南","河北","河南","山东","山西","陕西","安徽","福建","江西","广西","云南","贵州","辽宁","吉林","黑龙江","内蒙古","新疆","西藏","宁夏","甘肃","青海","天津","重庆","海南"],searchQuery:"",filterRegion:"",filter985:"",filter211:"",currentPage:1,pageSize:10,totalUniversities:0}},created(){this.fetchUniversities()},methods:{formatDateTime:Y,fetchUniversities(){this.loading=!0,w.getUniversities({page_size:1e4}).then(r=>{console.log("获取高校列表:",r),r.data&&r.data.results?this.universities=r.data.results:Array.isArray(r.data)?this.universities=r.data:this.universities=[],console.log(`成功加载 ${this.universities.length} 所大学`),this.applyFilters()}).catch(r=>{console.error("获取高校列表失败:",r),this.$message.error("获取高校列表失败")}).finally(()=>{this.loading=!1})},applyFilters(){if(!Array.isArray(this.universities)){this.universities=[],this.filteredUniversities=[],this.totalUniversities=0;return}let r=[...this.universities];if(this.searchQuery){const n=this.searchQuery.toLowerCase();r=r.filter(d=>d.name.toLowerCase().includes(n)||d.englishName&&d.englishName.toLowerCase().includes(n))}if(this.filterRegion&&(r=r.filter(n=>n.region===this.filterRegion)),this.filter985!==""){const n=this.filter985==="true";r=r.filter(d=>d.is985===n)}if(this.filter211!==""){const n=this.filter211==="true";r=r.filter(d=>d.is211===n)}this.totalUniversities=r.length;const e=(this.currentPage-1)*this.pageSize;this.filteredUniversities=r.slice(e,e+this.pageSize)},handleSearch(){this.currentPage=1,this.applyFilters()},handleSizeChange(r){this.pageSize=r,this.applyFilters()},handleCurrentChange(r){this.currentPage=r,this.applyFilters()},openAddDialog(){this.isEditing=!1,this.dialogTitle="添加高校",this.universityForm={name:"",englishName:"",region:"",establishYear:new Date().getFullYear(),website:"",ranking:1,min_hsk_level:5,tuition_fee:null,language_requirements:"",scholarship:"",is985:!1,is211:!1,isDoubleFirstClass:!1,description:""},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.universityForm&&this.$refs.universityForm.clearValidate()})},editUniversity(r){console.log("编辑高校:",r),this.isEditing=!0,this.dialogTitle="编辑高校",this.universityForm=JSON.parse(JSON.stringify(r)),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.universityForm&&this.$refs.universityForm.clearValidate()})},submitUniversity(){this.$refs.universityForm.validate(r=>{if(!r)return;this.submitLoading=!0,(this.isEditing?w.updateUniversity(this.universityForm.id,this.universityForm):w.createUniversity(this.universityForm)).then(n=>{console.log("保存高校成功:",n),this.$message.success(this.isEditing?"高校更新成功":"高校添加成功"),this.dialogVisible=!1,this.fetchUniversities()}).catch(n=>{var d,t;console.error("保存高校失败:",n),this.$message.error("保存失败: "+(((t=(d=n.response)==null?void 0:d.data)==null?void 0:t.message)||n.message))}).finally(()=>{this.submitLoading=!1})})},confirmDelete(r){this.$confirm(`确定要删除「${r.name}」吗?`,"警告",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{this.loading=!0,w.deleteUniversity(r.id).then(()=>{this.$message.success("高校删除成功"),this.fetchUniversities()}).catch(e=>{var n,d;console.error("删除高校失败:",e),this.$message.error("删除失败: "+(((d=(n=e.response)==null?void 0:n.data)==null?void 0:d.message)||e.message))}).finally(()=>{this.loading=!1})}).catch(()=>{})}}},B={class:"university-container"},E={class:"page-header"},R={class:"search-area"},Q={class:"table-container"},I={key:0,style:{color:"#fa8c16","font-weight":"bold"}},J={key:1,style:{color:"#999"}},j={key:1,style:{color:"#999"}},O=["href"],G={style:{"font-size":"12px"}},M={class:"pagination-container"},W={class:"dialog-footer"};function X(r,e,n,d,t,f){const V=g("el-button"),y=g("el-input"),a=g("el-option"),c=g("el-select"),p=g("el-table-column"),_=g("el-tag"),x=g("el-table"),D=g("el-pagination"),m=g("el-form-item"),U=g("el-input-number"),k=g("el-divider"),C=g("el-switch"),N=g("el-form"),K=g("el-dialog"),L=P("loading");return o(),b("div",B,[v("div",E,[e[21]||(e[21]=v("h1",null,"高校信息管理",-1)),l(V,{type:"primary",onClick:f.openAddDialog},{default:s(()=>e[20]||(e[20]=[u("添加高校")])),_:1,__:[20]},8,["onClick"])]),v("div",R,[l(y,{modelValue:t.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=i=>t.searchQuery=i),placeholder:"搜索高校名称","prefix-icon":"el-icon-search",clearable:"",onInput:f.handleSearch},null,8,["modelValue","onInput"]),l(c,{modelValue:t.filterRegion,"onUpdate:modelValue":e[1]||(e[1]=i=>t.filterRegion=i),placeholder:"按地区筛选",onChange:f.handleSearch},{default:s(()=>[l(a,{label:"全部地区",value:""}),(o(!0),b(S,null,z(t.regions,i=>(o(),h(a,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),l(c,{modelValue:t.filter985,"onUpdate:modelValue":e[2]||(e[2]=i=>t.filter985=i),placeholder:"985工程",onChange:f.handleSearch},{default:s(()=>[l(a,{label:"全部",value:""}),l(a,{label:"是",value:"true"}),l(a,{label:"否",value:"false"})]),_:1},8,["modelValue","onChange"]),l(c,{modelValue:t.filter211,"onUpdate:modelValue":e[3]||(e[3]=i=>t.filter211=i),placeholder:"211工程",onChange:f.handleSearch},{default:s(()=>[l(a,{label:"全部",value:""}),l(a,{label:"是",value:"true"}),l(a,{label:"否",value:"false"})]),_:1},8,["modelValue","onChange"])]),v("div",Q,[q((o(),h(x,{data:t.filteredUniversities,stripe:"",border:"",style:{width:"100%"}},{default:s(()=>[l(p,{prop:"name",label:"高校名称",width:"180"}),l(p,{prop:"region",label:"所在地区",width:"100"}),l(p,{label:"学费(元/年)",width:"130",align:"right"},{default:s(i=>[i.row.tuition_fee?(o(),b("span",I," ¥"+F(i.row.tuition_fee.toLocaleString()),1)):(o(),b("span",J,"-"))]),_:1}),l(p,{label:"HSK要求",width:"100",align:"center"},{default:s(i=>[i.row.min_hsk_level?(o(),h(_,{key:0,type:"warning",size:"small"},{default:s(()=>[u(" HSK "+F(i.row.min_hsk_level),1)]),_:2},1024)):(o(),b("span",j,"-"))]),_:1}),l(p,{prop:"establishYear",label:"建校时间",width:"100"}),l(p,{prop:"website",label:"官网","min-width":"150"},{default:s(i=>[v("a",{href:i.row.website,target:"_blank",style:{"font-size":"12px"}},F(i.row.website),9,O)]),_:1}),l(p,{label:"985工程",width:"80",align:"center"},{default:s(i=>[i.row.is985?(o(),h(_,{key:0,type:"success",size:"small"},{default:s(()=>e[22]||(e[22]=[u("是")])),_:1,__:[22]})):(o(),h(_,{key:1,type:"info",size:"small"},{default:s(()=>e[23]||(e[23]=[u("否")])),_:1,__:[23]}))]),_:1}),l(p,{label:"211工程",width:"80",align:"center"},{default:s(i=>[i.row.is211?(o(),h(_,{key:0,type:"success",size:"small"},{default:s(()=>e[24]||(e[24]=[u("是")])),_:1,__:[24]})):(o(),h(_,{key:1,type:"info",size:"small"},{default:s(()=>e[25]||(e[25]=[u("否")])),_:1,__:[25]}))]),_:1}),l(p,{label:"双一流",width:"80",align:"center"},{default:s(i=>[i.row.isDoubleFirstClass?(o(),h(_,{key:0,type:"success",size:"small"},{default:s(()=>e[26]||(e[26]=[u("是")])),_:1,__:[26]})):(o(),h(_,{key:1,type:"info",size:"small"},{default:s(()=>e[27]||(e[27]=[u("否")])),_:1,__:[27]}))]),_:1}),l(p,{label:"创建时间",width:"160"},{default:s(i=>[v("span",G,F(f.formatDateTime(i.row.createdAt)),1)]),_:1}),l(p,{label:"操作",width:"160",fixed:"right"},{default:s(i=>[l(V,{size:"small",type:"primary",onClick:T=>f.editUniversity(i.row)},{default:s(()=>e[28]||(e[28]=[u("编辑")])),_:2,__:[28]},1032,["onClick"]),l(V,{size:"small",type:"danger",onClick:T=>f.confirmDelete(i.row)},{default:s(()=>e[29]||(e[29]=[u("删除")])),_:2,__:[29]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,t.loading]]),v("div",M,[l(D,{onSizeChange:f.handleSizeChange,onCurrentChange:f.handleCurrentChange,"current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalUniversities},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),l(K,{title:t.dialogTitle,modelValue:t.dialogVisible,"onUpdate:modelValue":e[19]||(e[19]=i=>t.dialogVisible=i),width:"50%"},{footer:s(()=>[v("span",W,[l(V,{onClick:e[18]||(e[18]=i=>t.dialogVisible=!1)},{default:s(()=>e[34]||(e[34]=[u("取消")])),_:1,__:[34]}),l(V,{type:"primary",onClick:f.submitUniversity,loading:t.submitLoading},{default:s(()=>e[35]||(e[35]=[u("确定")])),_:1,__:[35]},8,["onClick","loading"])])]),default:s(()=>[l(N,{model:t.universityForm,rules:t.rules,ref:"universityForm","label-width":"120px"},{default:s(()=>[l(m,{label:"高校名称",prop:"name"},{default:s(()=>[l(y,{modelValue:t.universityForm.name,"onUpdate:modelValue":e[4]||(e[4]=i=>t.universityForm.name=i),placeholder:"请输入高校名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"英文名称",prop:"englishName"},{default:s(()=>[l(y,{modelValue:t.universityForm.englishName,"onUpdate:modelValue":e[5]||(e[5]=i=>t.universityForm.englishName=i),placeholder:"请输入英文名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"所在地区",prop:"region"},{default:s(()=>[l(c,{modelValue:t.universityForm.region,"onUpdate:modelValue":e[6]||(e[6]=i=>t.universityForm.region=i),placeholder:"请选择地区",style:{width:"100%"}},{default:s(()=>[(o(!0),b(S,null,z(t.regions,i=>(o(),h(a,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"建校时间",prop:"establishYear"},{default:s(()=>[l(U,{modelValue:t.universityForm.establishYear,"onUpdate:modelValue":e[7]||(e[7]=i=>t.universityForm.establishYear=i),min:1e3,max:2100},null,8,["modelValue"])]),_:1}),l(m,{label:"官网",prop:"website"},{default:s(()=>[l(y,{modelValue:t.universityForm.website,"onUpdate:modelValue":e[8]||(e[8]=i=>t.universityForm.website=i),placeholder:"请输入官网地址"},null,8,["modelValue"])]),_:1}),l(m,{label:"排名",prop:"ranking"},{default:s(()=>[l(U,{modelValue:t.universityForm.ranking,"onUpdate:modelValue":e[9]||(e[9]=i=>t.universityForm.ranking=i),min:1,max:1e3},null,8,["modelValue"])]),_:1}),l(k,{"content-position":"left"},{default:s(()=>e[30]||(e[30]=[u("入学要求")])),_:1,__:[30]}),l(m,{label:"HSK等级要求"},{default:s(()=>[l(c,{modelValue:t.universityForm.min_hsk_level,"onUpdate:modelValue":e[10]||(e[10]=i=>t.universityForm.min_hsk_level=i),placeholder:"请选择HSK等级",style:{width:"100%"}},{default:s(()=>[l(a,{label:"HSK 1",value:1}),l(a,{label:"HSK 2",value:2}),l(a,{label:"HSK 3",value:3}),l(a,{label:"HSK 4",value:4}),l(a,{label:"HSK 5",value:5}),l(a,{label:"HSK 6",value:6})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"学费(元/年)",prop:"tuition_fee"},{default:s(()=>[l(U,{modelValue:t.universityForm.tuition_fee,"onUpdate:modelValue":e[11]||(e[11]=i=>t.universityForm.tuition_fee=i),min:0,max:1e5,step:1e3,placeholder:"请输入学费",style:{width:"100%"}},null,8,["modelValue"]),e[31]||(e[31]=v("div",{style:{color:"#909399","font-size":"12px","margin-top":"5px"}}," 参考：文科约20,000-25,000元，理工科约25,000-30,000元 ",-1))]),_:1,__:[31]}),l(m,{label:"语言要求"},{default:s(()=>[l(y,{modelValue:t.universityForm.language_requirements,"onUpdate:modelValue":e[12]||(e[12]=i=>t.universityForm.language_requirements=i),placeholder:"例如：HSK 5级及以上，部分专业要求6级",type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1}),l(m,{label:"奖学金信息"},{default:s(()=>[l(y,{modelValue:t.universityForm.scholarship,"onUpdate:modelValue":e[13]||(e[13]=i=>t.universityForm.scholarship=i),placeholder:"例如：中国政府奖学金、大学国际学生奖学金",type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1}),l(k,{"content-position":"left"},{default:s(()=>e[32]||(e[32]=[u("学校标签")])),_:1,__:[32]}),l(m,{label:"985工程"},{default:s(()=>[l(C,{modelValue:t.universityForm.is985,"onUpdate:modelValue":e[14]||(e[14]=i=>t.universityForm.is985=i)},null,8,["modelValue"])]),_:1}),l(m,{label:"211工程"},{default:s(()=>[l(C,{modelValue:t.universityForm.is211,"onUpdate:modelValue":e[15]||(e[15]=i=>t.universityForm.is211=i)},null,8,["modelValue"])]),_:1}),l(m,{label:"双一流"},{default:s(()=>[l(C,{modelValue:t.universityForm.isDoubleFirstClass,"onUpdate:modelValue":e[16]||(e[16]=i=>t.universityForm.isDoubleFirstClass=i)},null,8,["modelValue"])]),_:1}),l(k,{"content-position":"left"},{default:s(()=>e[33]||(e[33]=[u("学校介绍")])),_:1,__:[33]}),l(m,{label:"简介",prop:"description"},{default:s(()=>[l(y,{type:"textarea",modelValue:t.universityForm.description,"onUpdate:modelValue":e[17]||(e[17]=i=>t.universityForm.description=i),rows:"4"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}const $=H(A,[["render",X],["__scopeId","data-v-b03bf270"]]);export{$ as default};
