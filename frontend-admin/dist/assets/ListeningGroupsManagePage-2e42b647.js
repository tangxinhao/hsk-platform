import{_ as j,C as T,y as E,W as O,z as B,A as F,q as W,D as Q,h as G,u as X,r as f,i as Y,b as u,G as Z,o as g,c as b,e as l,w as a,E as k,d as m,g as i,J as $,K as ee,N as I,L as S,t as _,M as J}from"./index-e5bf8409.js";const te={name:"ListeningGroupsManagePage",components:{Refresh:T,Plus:E,View:O,Edit:B,Delete:F,Clock:W,Headset:Q},setup(){G.defaults.baseURL||(G.defaults.baseURL="/api",console.log("已设置axios.defaults.baseURL = /api"));const V=X(),n=f(!1),D=f(!1),t=f([]),q=f(""),z=f(1),y=f(10),h=f(0),L=f(!1),s=f(null),v=async()=>{var o,r,c;n.value=!0;try{const d={};q.value&&(d.level=q.value),console.log("正在请求API: /question/listening-groups/",d);const e=await G.get("/question/listening-groups/",{params:d});if(console.log("API完整响应:",e.data),t.value=[],e.data){let w=[];Array.isArray(e.data.results)?w=e.data.results:Array.isArray(e.data)&&(w=e.data),t.value=w.map(p=>!p||typeof p!="object"?{material_group:"",title:"",level:0,question_count:0,audio_duration:0,play_times:0,audio_url:""}:{material_group:p.material_group||"",title:p.title||"",level:p.level||0,question_count:p.question_count||0,audio_duration:p.audio_duration||0,play_times:p.play_times||0,audio_url:p.audio_url||"",created_at:p.created_at||""}),h.value=e.data.count||t.value.length}else h.value=0;console.log("解析后的题组列表:",t.value.length,"个"),console.log("题组数据:",t.value)}catch(d){console.error("获取题组列表失败:",d),console.error("错误详情:",(o=d.response)==null?void 0:o.data),k.error("获取题组列表失败: "+(((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.detail)||d.message)),t.value=[],h.value=0}finally{n.value=!1}},H=async o=>{var r,c,d;if(!o||!o.material_group){k.error("无效的题组数据");return}L.value=!0,D.value=!0,s.value=null;try{console.log("正在获取题组详情:",o.material_group);const e=await G.get(`/question/listening-group/${o.material_group}/`);console.log("题组详情:",e.data),s.value={material:e.data.material||{},questions:Array.isArray(e.data.questions)?e.data.questions:[]}}catch(e){console.error("获取题组详情失败:",e),console.error("错误详情:",(r=e.response)==null?void 0:r.data),k.error("获取题组详情失败: "+(((d=(c=e.response)==null?void 0:c.data)==null?void 0:d.detail)||e.message))}finally{D.value=!1}},x=o=>{V.push(`/listening-group/edit/${o.material_group}`)},N=async o=>{var r,c,d;try{console.log("正在删除题组:",o),await G.delete(`/question/listening-group/${o}/delete/`),k.success("删除成功"),v()}catch(e){console.error("删除失败:",e),console.error("错误详情:",(r=e.response)==null?void 0:r.data),k.error("删除失败: "+(((d=(c=e.response)==null?void 0:c.data)==null?void 0:d.detail)||e.message))}},U=o=>{if(!o)return"未知";const r=Math.floor(o/60),c=o%60;return`${r}:${c.toString().padStart(2,"0")}`},K=o=>{if(!o)return"-";try{return new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("日期格式化错误:",r,o),"-"}},P=o=>["","success","success","warning","warning","danger","danger"][o]||"info",A=o=>({single:"单选题",multiple:"多选题",judge:"判断题"})[o]||o,M=o=>{try{const r=typeof o=="string"?JSON.parse(o):o;return r!=null&&r.options&&Array.isArray(r.options)?r.options.length:Array.isArray(r)?r.length:0}catch{return 0}},R=o=>{try{const r=typeof o=="string"?JSON.parse(o):o,c=(r==null?void 0:r.option_type)||"text";return{text:"文字",image:"图片",mixed:"图文"}[c]||"文字"}catch(r){return console.error("解析选项类型失败:",r,o),"文字"}},C=o=>{z.value=o};return Y(()=>{v()}),{loading:n,detailLoading:D,listeningGroups:t,levelFilter:q,currentPage:z,pageSize:y,total:h,detailDialogVisible:L,selectedGroup:s,fetchGroups:v,viewDetail:H,editGroup:x,deleteGroup:N,formatDuration:U,formatDate:K,getLevelType:P,getTypeLabel:A,getOptionsCount:M,getOptionTypeLabel:R,handlePageChange:C,Refresh:T,Plus:E,View:O,Edit:B,Delete:F}}},le={class:"listening-groups-page"},oe={class:"card-header"},ae={class:"header-actions"},ne={class:"filter-container"},re={class:"audio-info-cell"},ie={key:0,class:"empty-container"},se={key:1,class:"pagination-container"},de={key:0},ue={key:1},ce={key:1,style:{padding:"40px","text-align":"center"}};function _e(V,n,D,t,q,z){const y=u("el-button"),h=u("el-option"),L=u("el-select"),s=u("el-table-column"),v=u("el-tag"),H=u("Clock"),x=u("el-icon"),N=u("Headset"),U=u("el-popconfirm"),K=u("el-button-group"),P=u("el-table"),A=u("el-empty"),M=u("el-pagination"),R=u("el-card"),C=u("el-descriptions-item"),o=u("el-descriptions"),r=u("el-rate"),c=u("el-dialog"),d=Z("loading");return g(),b("div",le,[l(R,{class:"box-card"},{header:a(()=>[m("div",oe,[n[7]||(n[7]=m("h3",null,"听力题组管理",-1)),m("div",ae,[l(y,{type:"success",onClick:t.fetchGroups,icon:t.Refresh},{default:a(()=>n[5]||(n[5]=[i("刷新")])),_:1,__:[5]},8,["onClick","icon"]),l(y,{type:"primary",onClick:n[0]||(n[0]=e=>V.$router.push("/listening-group/add")),icon:t.Plus},{default:a(()=>n[6]||(n[6]=[i(" 批量添加题组 ")])),_:1,__:[6]},8,["icon"])])])]),default:a(()=>[m("div",ne,[l(L,{modelValue:t.levelFilter,"onUpdate:modelValue":n[1]||(n[1]=e=>t.levelFilter=e),placeholder:"HSK等级",clearable:"",onChange:t.fetchGroups},{default:a(()=>[l(h,{label:"全部",value:""}),(g(),b($,null,ee(6,e=>l(h,{key:e,label:`HSK ${e}级`,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue","onChange"])]),I((g(),S(P,{data:t.listeningGroups,border:"",style:{width:"100%"}},{default:a(()=>[l(s,{prop:"material_group",label:"题组ID",width:"200","show-overflow-tooltip":""}),l(s,{prop:"title",label:"材料标题","min-width":"200","show-overflow-tooltip":""}),l(s,{prop:"level",label:"HSK等级",width:"100",align:"center"},{default:a(e=>[l(v,{type:t.getLevelType(e.row.level)},{default:a(()=>[i(" HSK "+_(e.row.level)+"级 ",1)]),_:2},1032,["type"])]),_:1}),l(s,{prop:"question_count",label:"题目数量",width:"100",align:"center"},{default:a(e=>[e.row.question_count>0?(g(),S(v,{key:0,type:"success"},{default:a(()=>[i(_(e.row.question_count)+" 题 ",1)]),_:2},1024)):(g(),S(v,{key:1,type:"info"},{default:a(()=>n[8]||(n[8]=[i("0 题")])),_:1,__:[8]}))]),_:1}),l(s,{label:"音频信息",width:"180",align:"center"},{default:a(e=>[m("div",re,[m("div",null,[l(x,null,{default:a(()=>[l(H)]),_:1}),i(" "+_(t.formatDuration(e.row.audio_duration)),1)]),m("div",null,[l(x,null,{default:a(()=>[l(N)]),_:1}),i(" 播放 "+_(e.row.play_times)+" 次 ",1)])])]),_:1}),l(s,{prop:"created_at",label:"创建时间",width:"180",align:"center"},{default:a(e=>[i(_(t.formatDate(e.row.created_at)),1)]),_:1}),l(s,{label:"操作",width:"280",fixed:"right",align:"center"},{default:a(e=>[l(K,null,{default:a(()=>[l(y,{size:"small",type:"primary",onClick:w=>t.viewDetail(e.row),icon:t.View},{default:a(()=>n[9]||(n[9]=[i(" 查看 ")])),_:2,__:[9]},1032,["onClick","icon"]),l(y,{size:"small",type:"warning",onClick:w=>t.editGroup(e.row),icon:t.Edit},{default:a(()=>n[10]||(n[10]=[i(" 编辑 ")])),_:2,__:[10]},1032,["onClick","icon"]),l(U,{title:"确定删除该题组吗？",onConfirm:w=>t.deleteGroup(e.row.material_group),width:"200"},{reference:a(()=>[l(y,{size:"small",type:"danger",icon:t.Delete},{default:a(()=>n[11]||(n[11]=[i(" 删除 ")])),_:1,__:[11]},8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[d,t.loading]]),!t.loading&&(!t.listeningGroups||t.listeningGroups.length===0)?(g(),b("div",ie,[l(A,{description:"暂无听力题组数据"},{default:a(()=>[l(y,{type:"primary",onClick:n[2]||(n[2]=e=>V.$router.push("/listening-group/add"))},{default:a(()=>n[12]||(n[12]=[i(" 添加第一个题组 ")])),_:1,__:[12]})]),_:1})])):J("",!0),t.listeningGroups&&t.listeningGroups.length>0?(g(),b("div",se,[l(M,{"current-page":t.currentPage,"onUpdate:currentPage":n[3]||(n[3]=e=>t.currentPage=e),"page-size":t.pageSize,total:t.total,layout:"total, prev, pager, next",onCurrentChange:t.handlePageChange,background:""},null,8,["current-page","page-size","total","onCurrentChange"])])):J("",!0)]),_:1}),l(c,{modelValue:t.detailDialogVisible,"onUpdate:modelValue":n[4]||(n[4]=e=>t.detailDialogVisible=e),title:"题组详情",width:"80%"},{default:a(()=>[I((g(),b("div",null,[t.selectedGroup&&t.selectedGroup.material?(g(),b("div",de,[n[13]||(n[13]=m("h4",null,"材料信息",-1)),l(o,{column:2,border:""},{default:a(()=>[l(C,{label:"标题"},{default:a(()=>[i(_(t.selectedGroup.material.title||"-"),1)]),_:1}),l(C,{label:"HSK等级"},{default:a(()=>[i("HSK "+_(t.selectedGroup.material.level||"-")+"级",1)]),_:1}),l(C,{label:"音频时长"},{default:a(()=>[i(_(t.formatDuration(t.selectedGroup.material.audio_duration||0)),1)]),_:1}),l(C,{label:"播放次数"},{default:a(()=>[i(_(t.selectedGroup.material.play_times||0)+" 次",1)]),_:1}),l(C,{label:"题目数量"},{default:a(()=>[i(_(t.selectedGroup.questions&&t.selectedGroup.questions.length||0)+" 道",1)]),_:1})]),_:1}),n[14]||(n[14]=m("h4",{style:{"margin-top":"20px"}},"题目列表",-1)),l(P,{data:t.selectedGroup.questions||[],border:""},{default:a(()=>[l(s,{prop:"question_number",label:"题号",width:"80",align:"center"}),l(s,{prop:"content",label:"题目内容","min-width":"200","show-overflow-tooltip":""}),l(s,{prop:"type",label:"题型",width:"100",align:"center"},{default:a(e=>[i(_(t.getTypeLabel(e.row.type)),1)]),_:1}),l(s,{label:"选项数量",width:"100",align:"center"},{default:a(e=>[i(_(t.getOptionsCount(e.row.options))+" 个 ",1)]),_:1}),l(s,{label:"选项类型",width:"100",align:"center"},{default:a(e=>[i(_(t.getOptionTypeLabel(e.row.options)),1)]),_:1}),l(s,{prop:"answer",label:"答案",width:"80",align:"center"},{default:a(e=>[l(v,{type:"success"},{default:a(()=>[i(_(e.row.answer),1)]),_:2},1024)]),_:1}),l(s,{prop:"difficulty",label:"难度",width:"120",align:"center"},{default:a(e=>[e.row.difficulty?(g(),S(r,{key:0,modelValue:e.row.difficulty,"onUpdate:modelValue":w=>e.row.difficulty=w,disabled:"",max:5,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(g(),b("span",ue,"-"))]),_:1})]),_:1},8,["data"])])):(g(),b("div",ce,[l(A,{description:"无法加载题组详情"})]))])),[[d,t.detailLoading]])]),_:1},8,["modelValue"])])}const pe=j(te,[["render",_e],["__scopeId","data-v-620986f8"]]);export{pe as default};
