import{_ as Y,D as Z,l as $,y as T,A as I,X as ee,Y as le,u as ae,r as C,h as z,a as te,b as i,o as d,c as g,e,w as l,E as p,d as v,g as f,J as O,K as H,t as q,L as U,M as E}from"./index-e5bf8409.js";const oe={name:"ListeningGroupPage",components:{Headset:Z,Document:$,Plus:T,Delete:I,UploadFilled:ee,ArrowLeft:le},setup(){const N=ae(),a=C(!1),M=C(""),t=C(""),k=C(!1),L=C(0),P=C(null);z.defaults.baseURL||(z.defaults.baseURL="/api",console.log("已设置axios.defaults.baseURL = /api"));const r=te({material:{title:"",level:1,play_times:2,part_number:1,duration:0,audio_file:null},questions:[R()]});function R(){return{content:"",type:"single",option_type:"text",difficulty:2,answer:"",explanation:"",options:[{label:"A",value:"A",text:"",image:""},{label:"B",value:"B",text:"",image:""},{label:"C",value:"C",text:"",image:""},{label:"D",value:"D",text:"",image:""}]}}function x(){r.questions.push(R()),p.success("已添加新题目")}function B(m){r.questions.splice(m,1),p.success("已删除题目")}function V(m){const _=new FileReader;k.value=!0,_.onload=s=>{r.material.audio_file=s.target.result,M.value=m.name,t.value=s.target.result;const u=new Audio(s.target.result);u.addEventListener("loadedmetadata",()=>{L.value=Math.round(u.duration),r.material.duration=L.value,k.value=!1,p.success(`音频上传成功，时长：${c(L.value)}`)}),u.addEventListener("error",()=>{k.value=!1,p.error("音频加载失败，请检查文件格式")})},_.onerror=()=>{k.value=!1,p.error("音频文件读取失败")},_.readAsDataURL(m.raw)}function c(m){const _=Math.floor(m/60),s=m%60;return _>0?`${_}分${s}秒`:`${s}秒`}function b(m,_,s){const u=new FileReader;u.onload=F=>{r.questions[_].options[s].image=F.target.result},u.readAsDataURL(m.raw)}function h(m){r.questions[m].options.forEach(s=>{s.text="",s.image=""})}async function A(){var m,_;if(!r.material.title){p.error("请输入材料标题");return}if(!r.material.audio_file){p.error("请上传音频文件");return}if(r.questions.length===0){p.error("请至少添加一道题目");return}for(let s=0;s<r.questions.length;s++){const u=r.questions[s];if(!u.content.trim()){p.error(`第 ${s+1} 题的内容不能为空`);return}if(!u.answer){p.error(`第 ${s+1} 题请选择正确答案`);return}if(u.options.some(w=>u.option_type==="text"?!w.text.trim():u.option_type==="image"?!w.image:u.option_type==="mixed"?!w.image||!w.text.trim():!1)){p.error(`第 ${s+1} 题的选项未填写完整`);return}}a.value=!0;try{console.log("正在提交题组数据...",r);const s=await z.post("/question/listening-group/",r);s.data.success?(p.success(s.data.message),N.push("/questions")):p.error(s.data.error||"保存失败")}catch(s){console.error("保存失败:",s),p.error("保存失败："+(((_=(m=s.response)==null?void 0:m.data)==null?void 0:_.error)||s.message))}finally{a.value=!1}}return{formData:r,saving:a,audioFileName:M,audioPreviewUrl:t,addQuestion:x,removeQuestion:B,handleAudioChange:V,handleOptionImageChange:b,handleOptionTypeChange:h,saveListeningGroup:A,formatDuration:c,audioUploading:k,audioDuration:L,audioPlayer:P,Delete:I,Plus:T}}},ne={class:"listening-group-page"},se={class:"card-header"},re={key:0,class:"audio-preview-box"},ie={class:"audio-file-info"},de=["src"],ue={class:"questions-container"},me={class:"question-header"},_e={class:"question-number"},ce={class:"options-container"},pe={key:1,class:"option-image-container"},fe=["src"],ge={key:2,class:"option-mixed-container"},ve=["src"];function ye(N,a,M,t,k,L){const P=i("Headset"),r=i("el-icon"),R=i("ArrowLeft"),x=i("el-button"),B=i("el-divider"),V=i("el-input"),c=i("el-form-item"),b=i("el-col"),h=i("el-option"),A=i("el-select"),m=i("el-input-number"),_=i("el-row"),s=i("upload-filled"),u=i("el-upload"),F=i("Clock"),w=i("el-tag"),j=i("Document"),G=i("el-radio"),J=i("el-radio-group"),W=i("el-rate"),K=i("Plus"),S=i("el-card"),X=i("el-form");return d(),g("div",ne,[e(S,{class:"box-card"},{header:l(()=>[v("div",se,[v("h3",null,[e(r,{style:{"margin-right":"8px","vertical-align":"middle"}},{default:l(()=>[e(P)]),_:1}),a[5]||(a[5]=f(" 批量添加听力题组 "))]),e(x,{onClick:a[0]||(a[0]=o=>N.$router.back())},{default:l(()=>[e(r,{style:{"margin-right":"4px"}},{default:l(()=>[e(R)]),_:1}),a[6]||(a[6]=f(" 返回 "))]),_:1,__:[6]})])]),default:l(()=>[e(X,{model:t.formData,"label-width":"120px"},{default:l(()=>[e(B,{"content-position":"left"},{default:l(()=>[e(r,null,{default:l(()=>[e(P)]),_:1}),a[7]||(a[7]=f(" 音频材料 "))]),_:1,__:[7]}),e(_,{gutter:20},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(c,{label:"材料标题",required:""},{default:l(()=>[e(V,{modelValue:t.formData.material.title,"onUpdate:modelValue":a[1]||(a[1]=o=>t.formData.material.title=o),placeholder:"例如：HSK1 听力 Part1"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:6},{default:l(()=>[e(c,{label:"HSK等级",required:""},{default:l(()=>[e(A,{modelValue:t.formData.material.level,"onUpdate:modelValue":a[2]||(a[2]=o=>t.formData.material.level=o),placeholder:"选择等级"},{default:l(()=>[(d(),g(O,null,H(6,o=>e(h,{key:o,label:`HSK ${o}级`,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:6},{default:l(()=>[e(c,{label:"播放次数"},{default:l(()=>[e(m,{modelValue:t.formData.material.play_times,"onUpdate:modelValue":a[3]||(a[3]=o=>t.formData.material.play_times=o),min:1,max:5},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{label:"音频文件",required:""},{default:l(()=>[e(u,{class:"audio-uploader","auto-upload":!1,"show-file-list":!0,"on-change":t.handleAudioChange,accept:"audio/mp3,audio/wav",drag:""},{tip:l(()=>a[8]||(a[8]=[v("div",{class:"el-upload__tip"}," 支持 MP3/WAV 格式，建议文件大小不超过 50MB ",-1)])),default:l(()=>[e(r,{class:"el-icon--upload"},{default:l(()=>[e(s)]),_:1}),a[9]||(a[9]=v("div",{class:"el-upload__text"},[f(" 拖拽音频文件到此处 或 "),v("em",null,"点击上传")],-1))]),_:1,__:[9]},8,["on-change"]),t.audioFileName?(d(),g("div",re,[v("div",ie,[e(r,null,{default:l(()=>[e(P)]),_:1}),v("span",null,q(t.audioFileName),1),t.audioDuration>0?(d(),U(w,{key:0,type:"success",size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(F)]),_:1}),f(" "+q(t.formatDuration(t.audioDuration)),1)]),_:1})):E("",!0)]),t.audioPreviewUrl?(d(),g("audio",{key:0,ref:"audioPlayer",src:t.audioPreviewUrl,controls:"",class:"audio-player"},null,8,de)):E("",!0)])):E("",!0)]),_:1}),e(B,{"content-position":"left"},{default:l(()=>[e(r,null,{default:l(()=>[e(j)]),_:1}),f(" 题目列表 ("+q(t.formData.questions.length)+"道) ",1)]),_:1}),v("div",ue,[(d(!0),g(O,null,H(t.formData.questions,(o,D)=>(d(),U(S,{key:D,class:"question-card",shadow:"hover"},{header:l(()=>[v("div",me,[v("span",_e,"第 "+q(D+1)+" 题",1),t.formData.questions.length>1?(d(),U(x,{key:0,type:"danger",size:"small",icon:t.Delete,onClick:n=>t.removeQuestion(D)},{default:l(()=>a[10]||(a[10]=[f(" 删除此题 ")])),_:2,__:[10]},1032,["icon","onClick"])):E("",!0)])]),default:l(()=>[e(c,{label:"题目内容"},{default:l(()=>[e(V,{modelValue:o.content,"onUpdate:modelValue":n=>o.content=n,placeholder:"输入题目内容或说明",type:"textarea",rows:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{gutter:20},{default:l(()=>[e(b,{span:8},{default:l(()=>[e(c,{label:"题型"},{default:l(()=>[e(A,{modelValue:o.type,"onUpdate:modelValue":n=>o.type=n},{default:l(()=>[e(h,{label:"单选题",value:"single"}),e(h,{label:"多选题",value:"multiple"}),e(h,{label:"判断题",value:"judge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(b,{span:8},{default:l(()=>[e(c,{label:"选项类型"},{default:l(()=>[e(J,{modelValue:o.option_type,"onUpdate:modelValue":n=>o.option_type=n,onChange:n=>t.handleOptionTypeChange(D)},{default:l(()=>[e(G,{value:"text"},{default:l(()=>a[11]||(a[11]=[f("文字")])),_:1,__:[11]}),e(G,{value:"image"},{default:l(()=>a[12]||(a[12]=[f("图片")])),_:1,__:[12]}),e(G,{value:"mixed"},{default:l(()=>a[13]||(a[13]=[f("混合")])),_:1,__:[13]})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024),e(b,{span:8},{default:l(()=>[e(c,{label:"难度"},{default:l(()=>[e(W,{modelValue:o.difficulty,"onUpdate:modelValue":n=>o.difficulty=n,max:5,"show-score":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),v("div",ce,[(d(!0),g(O,null,H(o.options,(n,Q)=>(d(),g("div",{key:Q,class:"option-item"},[e(w,{size:"large",class:"option-label"},{default:l(()=>[f(q(n.label),1)]),_:2},1024),o.option_type==="text"?(d(),U(V,{key:0,modelValue:n.text,"onUpdate:modelValue":y=>n.text=y,placeholder:"输入选项内容",class:"option-input"},null,8,["modelValue","onUpdate:modelValue"])):o.option_type==="image"?(d(),g("div",pe,[e(u,{class:"option-image-uploader","auto-upload":!1,"show-file-list":!1,"on-change":y=>t.handleOptionImageChange(y,D,Q),accept:"image/*"},{default:l(()=>[n.image?(d(),g("img",{key:0,src:n.image,class:"option-image"},null,8,fe)):(d(),U(r,{key:1,class:"option-image-icon"},{default:l(()=>[e(K)]),_:1}))]),_:2},1032,["on-change"]),e(V,{modelValue:n.text,"onUpdate:modelValue":y=>n.text=y,placeholder:"图片说明（可选）",size:"small",class:"image-description"},null,8,["modelValue","onUpdate:modelValue"])])):o.option_type==="mixed"?(d(),g("div",ge,[e(u,{class:"mixed-image-uploader","auto-upload":!1,"show-file-list":!1,"on-change":y=>t.handleOptionImageChange(y,D,Q),accept:"image/*"},{default:l(()=>[n.image?(d(),g("img",{key:0,src:n.image,class:"mixed-image"},null,8,ve)):(d(),U(r,{key:1,class:"mixed-image-icon"},{default:l(()=>[e(K)]),_:1}))]),_:2},1032,["on-change"]),e(V,{modelValue:n.text,"onUpdate:modelValue":y=>n.text=y,placeholder:"输入文字说明",type:"textarea",rows:2,class:"mixed-text"},null,8,["modelValue","onUpdate:modelValue"])])):E("",!0)]))),128))]),e(c,{label:"正确答案",style:{"margin-top":"20px"}},{default:l(()=>[e(A,{modelValue:o.answer,"onUpdate:modelValue":n=>o.answer=n,placeholder:"选择正确答案"},{default:l(()=>[(d(!0),g(O,null,H(o.options,n=>(d(),U(h,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{label:"答案解析"},{default:l(()=>[e(V,{modelValue:o.explanation,"onUpdate:modelValue":n=>o.explanation=n,placeholder:"输入答案解析（选填）",type:"textarea",rows:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),e(x,{type:"primary",icon:t.Plus,onClick:t.addQuestion,class:"add-question-btn",plain:""},{default:l(()=>a[14]||(a[14]=[f(" 添加新题目 ")])),_:1,__:[14]},8,["icon","onClick"])]),e(c,{style:{"margin-top":"30px"}},{default:l(()=>[e(x,{onClick:a[4]||(a[4]=o=>N.$router.back())},{default:l(()=>a[15]||(a[15]=[f("取消")])),_:1,__:[15]}),e(x,{type:"primary",onClick:t.saveListeningGroup,loading:t.saving},{default:l(()=>a[16]||(a[16]=[f(" 保存题组 ")])),_:1,__:[16]},8,["onClick","loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}const be=Y(oe,[["render",ye],["__scopeId","data-v-b841fc13"]]);export{be as default};
