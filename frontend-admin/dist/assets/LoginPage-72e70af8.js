import{_ as b,u as h,r as k,a as L,b as p,o as S,c as E,d as a,e as r,w as d,f as I,g as z,h as B,E as y}from"./index-e5bf8409.js";const C={class:"login-page"},F={class:"login-box"},K={__name:"LoginPage",setup(N){const x=h(),m=k(null),g=k(!1),s=L({username:"",password:""}),V={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f=async()=>{var _,o,n,l,i,c,t,v;if(m.value)try{await m.value.validate(),g.value=!0,console.log("发送登录请求:",s);const e=await B.post("/user/login/",s);console.log("登录响应完整数据:",e),console.log("登录响应data:",e.data);const u=e.data.access||e.data.token,w=((_=e.data.user)==null?void 0:_.username)||s.username;if(console.log("提取的token:",u),console.log("提取的username:",w),!u)throw new Error("未收到认证令牌");localStorage.setItem("token",u),localStorage.setItem("refresh_token",e.data.refresh||""),localStorage.setItem("username",w),console.log("Token已保存到localStorage"),y.success("登录成功！"),setTimeout(()=>{console.log("准备跳转到首页"),x.push("/")},500)}catch(e){console.error("登录失败完整错误:",e),console.error("错误响应:",e.response),console.error("错误数据:",(o=e.response)==null?void 0:o.data);const u=((l=(n=e.response)==null?void 0:n.data)==null?void 0:l.detail)||((c=(i=e.response)==null?void 0:i.data)==null?void 0:c.message)||((v=(t=e.response)==null?void 0:t.data)==null?void 0:v.error)||e.message||"登录失败，请检查用户名和密码";y.error(u)}finally{g.value=!1}};return(_,o)=>{const n=p("el-input"),l=p("el-form-item"),i=p("el-button"),c=p("el-form");return S(),E("div",C,[a("div",F,[o[3]||(o[3]=a("div",{class:"login-header"},[a("h1",null,"HSK管理系统"),a("p",null,"欢迎登录后台管理")],-1)),r(c,{model:s,rules:V,ref_key:"loginFormRef",ref:m,class:"login-form"},{default:d(()=>[r(l,{prop:"username"},{default:d(()=>[r(n,{modelValue:s.username,"onUpdate:modelValue":o[0]||(o[0]=t=>s.username=t),placeholder:"请输入用户名",size:"large","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),r(l,{prop:"password"},{default:d(()=>[r(n,{modelValue:s.password,"onUpdate:modelValue":o[1]||(o[1]=t=>s.password=t),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":"Lock","show-password":"",onKeyup:I(f,["enter"])},null,8,["modelValue"])]),_:1}),r(l,null,{default:d(()=>[r(i,{type:"primary",size:"large",class:"login-button",loading:g.value,onClick:f},{default:d(()=>o[2]||(o[2]=[z(" 登录 ")])),_:1,__:[2]},8,["loading"])]),_:1})]),_:1},8,["model"]),o[4]||(o[4]=a("div",{class:"login-tip"},[a("p",null,"默认账号：admin / admin123456"),a("p",null,"测试账号：test / test123456")],-1))])])}}},R=b(K,[["__scopeId","data-v-2cd70de3"]]);export{R as default};
