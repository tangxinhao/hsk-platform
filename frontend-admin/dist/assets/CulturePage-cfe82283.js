import{_ as ee,r as _,a as H,v as Q,i as le,y as te,z as ae,A as oe,B as ne,b as s,G as re,o as h,c as j,e,w as o,j as F,E as y,I as W,d as b,g,N as X,L as B,t as N,J as G,K as J}from"./index-e5bf8409.js";const ie={name:"CulturePage",setup(){const K=_("categories"),t=_(!1),V=_([]),l=_(!1),S=_(null),A=_(""),u=_(""),c=H({id:null,name:"",level:"åˆçº§",description:""}),m={name:[{required:!0,message:"è¯·è¾“å…¥åˆ†ç±»åç§°",trigger:"blur"}],level:[{required:!0,message:"è¯·é€‰æ‹©ç­‰çº§",trigger:"change"}]},v=_(!1),r=_([]),x=_(!1),U=_(null),w=_(""),k=_(""),d=H({id:null,title:"",title_en:"",category:null,difficulty:3,duration:10,cover_image:"",content:"",content_en:"",paragraphs:[{zh:"",en:""}]}),q={title:[{required:!0,message:"è¯·è¾“å…¥ä¸­æ–‡æ ‡é¢˜",trigger:"blur"}],category:[{required:!0,message:"è¯·é€‰æ‹©åˆ†ç±»",trigger:"change"}]},I=Q(()=>{let n=V.value;return A.value&&(n=n.filter(i=>i.name.toLowerCase().includes(A.value.toLowerCase()))),u.value&&(n=n.filter(i=>i.level===u.value)),n}),p=Q(()=>{let n=r.value;return w.value&&(n=n.filter(i=>i.title.toLowerCase().includes(w.value.toLowerCase())||i.title_en&&i.title_en.toLowerCase().includes(w.value.toLowerCase()))),k.value&&(n=n.filter(i=>i.category===Number(k.value))),n}),E=n=>{const i=V.value.find(T=>T.id===n);return i?i.name:"-"},D=async()=>{t.value=!0;try{const n=await F.get("/culture/category/?page_size=100");n.data&&n.data.results?V.value=n.data.results:Array.isArray(n.data)?V.value=n.data:V.value=[],console.log("è·å–åˆ°çš„åˆ†ç±»:",V.value)}catch(n){console.error("è·å–åˆ†ç±»å¤±è´¥:",n),y.error("è·å–åˆ†ç±»åˆ—è¡¨å¤±è´¥"),V.value=[]}finally{t.value=!1}},C=()=>{Object.assign(c,{id:null,name:"",level:"åˆçº§",description:""}),l.value=!0},P=n=>{Object.assign(c,n),l.value=!0},R=async n=>{try{await W.confirm("ç¡®å®šè¦åˆ é™¤è¯¥åˆ†ç±»å—ï¼Ÿ","è­¦å‘Š",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await F.delete(`/culture/category/${n}/`),y.success("åˆ é™¤æˆåŠŸ"),await D()}catch(i){i!=="cancel"&&(console.error("åˆ é™¤å¤±è´¥:",i),y.error("åˆ é™¤å¤±è´¥"))}},O=async()=>{if(S.value)try{await S.value.validate();const n={name:c.name,level:c.level,description:c.description};c.id?(await F.put(`/culture/category/${c.id}/`,n),y.success("æ›´æ–°æˆåŠŸ")):(await F.post("/culture/category/",n),y.success("åˆ›å»ºæˆåŠŸ")),l.value=!1,await D()}catch(n){console.error("ä¿å­˜å¤±è´¥:",n),y.error("ä¿å­˜å¤±è´¥")}},z=async()=>{v.value=!0;try{const n=await F.get("/culture/content/?page_size=100");n.data&&n.data.results?r.value=n.data.results:Array.isArray(n.data)?r.value=n.data:r.value=[],console.log("è·å–åˆ°çš„å†…å®¹:",r.value)}catch(n){console.error("è·å–å†…å®¹å¤±è´¥:",n),y.error("è·å–å†…å®¹åˆ—è¡¨å¤±è´¥"),r.value=[]}finally{v.value=!1}},a=()=>{Object.assign(d,{id:null,title:"",title_en:"",category:null,difficulty:3,duration:10,cover_image:"",content:"",content_en:"",paragraphs:[{zh:"",en:""}]}),x.value=!0},f=n=>{Object.assign(d,{id:n.id,title:n.title,title_en:n.title_en||"",category:n.category,difficulty:n.difficulty,duration:n.duration,cover_image:n.cover_image||"",content:n.content,content_en:n.content_en||"",paragraphs:n.paragraphs&&n.paragraphs.length>0?n.paragraphs:[{zh:"",en:""}]}),x.value=!0},L=async n=>{try{await W.confirm("ç¡®å®šè¦åˆ é™¤è¯¥å†…å®¹å—ï¼Ÿ","è­¦å‘Š",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await F.delete(`/culture/content/${n}/`),y.success("åˆ é™¤æˆåŠŸ"),await z()}catch(i){i!=="cancel"&&(console.error("åˆ é™¤å¤±è´¥:",i),y.error("åˆ é™¤å¤±è´¥"))}},Y=()=>{d.paragraphs.push({zh:"",en:""})},Z=n=>{d.paragraphs.length>1?d.paragraphs.splice(n,1):y.warning("è‡³å°‘ä¿ç•™ä¸€ä¸ªæ®µè½")},$=async()=>{if(U.value)try{await U.value.validate();const n=d.paragraphs.map(M=>M.zh).filter(Boolean),i=d.paragraphs.map(M=>M.en).filter(Boolean),T={title:d.title,title_en:d.title_en||"",category:d.category,difficulty:d.difficulty,duration:d.duration,cover_image:d.cover_image||"",content:n.join(`

`),content_en:i.join(`

`),paragraphs:d.paragraphs,content_type:"article"};v.value=!0,d.id?(await F.put(`/culture/content/${d.id}/`,T),y.success("æ›´æ–°æˆåŠŸ")):(await F.post("/culture/content/",T),y.success("åˆ›å»ºæˆåŠŸ")),x.value=!1,await z()}catch(n){console.error("ä¿å­˜å¤±è´¥:",n),y.error("ä¿å­˜å¤±è´¥")}finally{v.value=!1}};return le(()=>{D(),z()}),{activeTab:K,categoryLoading:t,categories:V,filteredCategories:I,categoryDialogVisible:l,categoryForm:c,categoryRules:m,categoryFormRef:S,categorySearch:A,levelFilter:u,showAddCategoryDialog:C,editCategory:P,deleteCategory:R,submitCategory:O,contentLoading:v,contents:r,filteredContents:p,contentDialogVisible:x,contentForm:d,contentRules:q,contentFormRef:U,contentSearch:w,categoryFilter:k,showAddContentDialog:a,editContent:f,deleteContent:L,addParagraph:Y,removeParagraph:Z,submitContent:$,getCategoryName:E,Plus:te,Edit:ae,Delete:oe,Search:ne}}},de={class:"culture-page"},se={class:"card-header"},ce={class:"search-container"},ue={class:"card-header"},me={class:"search-container"},ge={style:{"font-style":"italic",color:"#606266"}},pe={class:"paragraphs-container"},fe={class:"paragraph-header"};function _e(K,t,V,l,S,A){const u=s("el-button"),c=s("el-input"),m=s("el-option"),v=s("el-select"),r=s("el-table-column"),x=s("el-tag"),U=s("el-table"),w=s("el-card"),k=s("el-tab-pane"),d=s("el-rate"),q=s("el-empty"),I=s("el-tabs"),p=s("el-form-item"),E=s("el-form"),D=s("el-dialog"),C=s("el-col"),P=s("el-row"),R=s("el-divider"),O=s("el-input-number"),z=re("loading");return h(),j("div",de,[e(I,{modelValue:l.activeTab,"onUpdate:modelValue":t[4]||(t[4]=a=>l.activeTab=a),type:"card"},{default:o(()=>[e(k,{label:"åˆ†ç±»ç®¡ç†",name:"categories"},{default:o(()=>[e(w,{class:"box-card"},{header:o(()=>[b("div",se,[t[19]||(t[19]=b("h3",null,"æ–‡åŒ–åˆ†ç±»ç®¡ç†",-1)),e(u,{type:"primary",onClick:l.showAddCategoryDialog,icon:l.Plus},{default:o(()=>t[18]||(t[18]=[g("æ–°å¢åˆ†ç±»")])),_:1,__:[18]},8,["onClick","icon"])])]),default:o(()=>[b("div",ce,[e(c,{modelValue:l.categorySearch,"onUpdate:modelValue":t[0]||(t[0]=a=>l.categorySearch=a),placeholder:"æœç´¢åˆ†ç±»åç§°",class:"search-input","prefix-icon":l.Search,clearable:""},null,8,["modelValue","prefix-icon"]),e(v,{modelValue:l.levelFilter,"onUpdate:modelValue":t[1]||(t[1]=a=>l.levelFilter=a),placeholder:"çº§åˆ«ç­›é€‰",clearable:""},{default:o(()=>[e(m,{label:"å…¨éƒ¨",value:""}),e(m,{label:"åˆçº§",value:"åˆçº§"}),e(m,{label:"ä¸­çº§",value:"ä¸­çº§"}),e(m,{label:"é«˜çº§",value:"é«˜çº§"})]),_:1},8,["modelValue"])]),X((h(),B(U,{data:l.filteredCategories,border:"",stripe:""},{default:o(()=>[e(r,{prop:"id",label:"ID",width:"80",sortable:""}),e(r,{prop:"name",label:"åç§°","min-width":"120"}),e(r,{prop:"level",label:"ç­‰çº§",width:"100"},{default:o(({row:a})=>[e(x,{type:a.level==="åˆçº§"?"success":a.level==="ä¸­çº§"?"warning":"danger"},{default:o(()=>[g(N(a.level),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"description",label:"æè¿°","min-width":"180"}),e(r,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:o(a=>[e(u,{size:"small",type:"primary",onClick:f=>l.editCategory(a.row),icon:l.Edit},{default:o(()=>t[20]||(t[20]=[g("ç¼–è¾‘")])),_:2,__:[20]},1032,["onClick","icon"]),e(u,{size:"small",type:"danger",onClick:f=>l.deleteCategory(a.row.id),icon:l.Delete},{default:o(()=>t[21]||(t[21]=[g("åˆ é™¤")])),_:2,__:[21]},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[z,l.categoryLoading]])]),_:1})]),_:1}),e(k,{label:"å†…å®¹ç®¡ç†",name:"content"},{default:o(()=>[e(w,{class:"box-card"},{header:o(()=>[b("div",ue,[t[23]||(t[23]=b("h3",null,"æ–‡åŒ–å†…å®¹ç®¡ç† (ä¸­è‹±åŒè¯­)",-1)),e(u,{type:"primary",onClick:l.showAddContentDialog,icon:l.Plus},{default:o(()=>t[22]||(t[22]=[g("æ–°å¢å†…å®¹")])),_:1,__:[22]},8,["onClick","icon"])])]),default:o(()=>[b("div",me,[e(c,{modelValue:l.contentSearch,"onUpdate:modelValue":t[2]||(t[2]=a=>l.contentSearch=a),placeholder:"æœç´¢å†…å®¹æ ‡é¢˜",class:"search-input","prefix-icon":l.Search,clearable:""},null,8,["modelValue","prefix-icon"]),e(v,{modelValue:l.categoryFilter,"onUpdate:modelValue":t[3]||(t[3]=a=>l.categoryFilter=a),placeholder:"åˆ†ç±»ç­›é€‰",clearable:""},{default:o(()=>[e(m,{label:"å…¨éƒ¨",value:""}),(h(!0),j(G,null,J(l.categories,a=>(h(),B(m,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),X((h(),B(U,{data:l.filteredContents,border:"",stripe:""},{default:o(()=>[e(r,{prop:"id",label:"ID",width:"80",sortable:""}),e(r,{prop:"title",label:"ä¸­æ–‡æ ‡é¢˜","min-width":"150"}),e(r,{prop:"title_en",label:"è‹±æ–‡æ ‡é¢˜","min-width":"150"},{default:o(({row:a})=>[b("span",ge,N(a.title_en||"-"),1)]),_:1}),e(r,{prop:"category",label:"åˆ†ç±»",width:"120"},{default:o(({row:a})=>[g(N(l.getCategoryName(a.category)),1)]),_:1}),e(r,{prop:"difficulty",label:"éš¾åº¦",width:"100"},{default:o(({row:a})=>[e(d,{modelValue:a.difficulty,"onUpdate:modelValue":f=>a.difficulty=f,disabled:"",max:5,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(r,{prop:"view_count",label:"æµè§ˆ",width:"80"}),e(r,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:o(a=>[e(u,{size:"small",type:"primary",onClick:f=>l.editContent(a.row),icon:l.Edit},{default:o(()=>t[24]||(t[24]=[g("ç¼–è¾‘")])),_:2,__:[24]},1032,["onClick","icon"]),e(u,{size:"small",type:"danger",onClick:f=>l.deleteContent(a.row.id),icon:l.Delete},{default:o(()=>t[25]||(t[25]=[g("åˆ é™¤")])),_:2,__:[25]},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[z,l.contentLoading]])]),_:1})]),_:1}),e(k,{label:"æ•°æ®ç»Ÿè®¡",name:"statistics"},{default:o(()=>[e(q,{description:"æ•°æ®ç»Ÿè®¡åŠŸèƒ½å¼€å‘ä¸­..."},{default:o(()=>[e(u,{type:"primary"},{default:o(()=>t[26]||(t[26]=[g("å³å°†ä¸Šçº¿")])),_:1,__:[26]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:l.categoryDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=a=>l.categoryDialogVisible=a),title:l.categoryForm.id?"ç¼–è¾‘æ–‡åŒ–åˆ†ç±»":"æ–°å¢æ–‡åŒ–åˆ†ç±»",width:"500px","close-on-click-modal":!1},{footer:o(()=>[e(u,{onClick:t[8]||(t[8]=a=>l.categoryDialogVisible=!1)},{default:o(()=>t[27]||(t[27]=[g("å–æ¶ˆ")])),_:1,__:[27]}),e(u,{type:"primary",onClick:l.submitCategory},{default:o(()=>t[28]||(t[28]=[g("ä¿å­˜")])),_:1,__:[28]},8,["onClick"])]),default:o(()=>[e(E,{model:l.categoryForm,rules:l.categoryRules,ref:"categoryFormRef","label-width":"80px"},{default:o(()=>[e(p,{label:"åç§°",prop:"name"},{default:o(()=>[e(c,{modelValue:l.categoryForm.name,"onUpdate:modelValue":t[5]||(t[5]=a=>l.categoryForm.name=a),placeholder:"è¯·è¾“å…¥åˆ†ç±»åç§°",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(p,{label:"ç­‰çº§",prop:"level"},{default:o(()=>[e(v,{modelValue:l.categoryForm.level,"onUpdate:modelValue":t[6]||(t[6]=a=>l.categoryForm.level=a),placeholder:"è¯·é€‰æ‹©ç­‰çº§",style:{width:"100%"}},{default:o(()=>[e(m,{label:"åˆçº§",value:"åˆçº§"}),e(m,{label:"ä¸­çº§",value:"ä¸­çº§"}),e(m,{label:"é«˜çº§",value:"é«˜çº§"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"æè¿°",prop:"description"},{default:o(()=>[e(c,{modelValue:l.categoryForm.description,"onUpdate:modelValue":t[7]||(t[7]=a=>l.categoryForm.description=a),type:"textarea",rows:4,maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(D,{modelValue:l.contentDialogVisible,"onUpdate:modelValue":t[17]||(t[17]=a=>l.contentDialogVisible=a),title:l.contentForm.id?"ç¼–è¾‘æ–‡åŒ–å†…å®¹":"æ–°å¢æ–‡åŒ–å†…å®¹",width:"900px","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[e(u,{onClick:t[16]||(t[16]=a=>l.contentDialogVisible=!1)},{default:o(()=>t[31]||(t[31]=[g("å–æ¶ˆ")])),_:1,__:[31]}),e(u,{type:"primary",onClick:l.submitContent,loading:l.contentLoading},{default:o(()=>t[32]||(t[32]=[g("ä¿å­˜")])),_:1,__:[32]},8,["onClick","loading"])]),default:o(()=>[e(E,{model:l.contentForm,rules:l.contentRules,ref:"contentFormRef","label-width":"100px"},{default:o(()=>[e(P,{gutter:20},{default:o(()=>[e(C,{span:12},{default:o(()=>[e(p,{label:"ä¸­æ–‡æ ‡é¢˜",prop:"title"},{default:o(()=>[e(c,{modelValue:l.contentForm.title,"onUpdate:modelValue":t[10]||(t[10]=a=>l.contentForm.title=a),placeholder:"ä¸­æ–‡æ ‡é¢˜",maxlength:"255","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:12},{default:o(()=>[e(p,{label:"è‹±æ–‡æ ‡é¢˜",prop:"title_en"},{default:o(()=>[e(c,{modelValue:l.contentForm.title_en,"onUpdate:modelValue":t[11]||(t[11]=a=>l.contentForm.title_en=a),placeholder:"English Title",maxlength:"255","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(P,{gutter:20},{default:o(()=>[e(C,{span:12},{default:o(()=>[e(p,{label:"åˆ†ç±»",prop:"category"},{default:o(()=>[e(v,{modelValue:l.contentForm.category,"onUpdate:modelValue":t[12]||(t[12]=a=>l.contentForm.category=a),placeholder:"è¯·é€‰æ‹©åˆ†ç±»",style:{width:"100%"}},{default:o(()=>[(h(!0),j(G,null,J(l.categories,a=>(h(),B(m,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(C,{span:12},{default:o(()=>[e(p,{label:"éš¾åº¦",prop:"difficulty"},{default:o(()=>[e(v,{modelValue:l.contentForm.difficulty,"onUpdate:modelValue":t[13]||(t[13]=a=>l.contentForm.difficulty=a),placeholder:"è¯·é€‰æ‹©éš¾åº¦",style:{width:"100%"}},{default:o(()=>[e(m,{label:"ç®€å•",value:1}),e(m,{label:"è¾ƒæ˜“",value:2}),e(m,{label:"ä¸­ç­‰",value:3}),e(m,{label:"è¾ƒéš¾",value:4}),e(m,{label:"å›°éš¾",value:5})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(R,{"content-position":"left"},{default:o(()=>t[29]||(t[29]=[b("span",{style:{"font-size":"16px","font-weight":"bold"}},"ğŸ“ ä¸­è‹±åŒè¯­æ®µè½å†…å®¹",-1)])),_:1,__:[29]}),b("div",pe,[(h(!0),j(G,null,J(l.contentForm.paragraphs,(a,f)=>(h(),B(w,{key:f,class:"paragraph-card",shadow:"hover"},{header:o(()=>[b("div",fe,[b("span",null,"æ®µè½ "+N(f+1),1),e(u,{type:"danger",size:"small",icon:l.Delete,onClick:L=>l.removeParagraph(f),circle:""},null,8,["icon","onClick"])])]),default:o(()=>[e(p,{label:"ä¸­æ–‡æ®µè½",prop:`paragraphs.${f}.zh`},{default:o(()=>[e(c,{modelValue:a.zh,"onUpdate:modelValue":L=>a.zh=L,type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ®µè½å†…å®¹..."},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),e(p,{label:"è‹±æ–‡æ®µè½",prop:`paragraphs.${f}.en`},{default:o(()=>[e(c,{modelValue:a.en,"onUpdate:modelValue":L=>a.en=L,type:"textarea",rows:3,placeholder:"Please enter English paragraph...",style:{"font-style":"italic"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024))),128)),e(u,{type:"primary",icon:l.Plus,onClick:l.addParagraph,style:{width:"100%","margin-top":"10px"},plain:""},{default:o(()=>t[30]||(t[30]=[g(" æ·»åŠ æ–°æ®µè½ ")])),_:1,__:[30]},8,["icon","onClick"])]),e(R),e(P,{gutter:20},{default:o(()=>[e(C,{span:12},{default:o(()=>[e(p,{label:"æ—¶é•¿(åˆ†é’Ÿ)",prop:"duration"},{default:o(()=>[e(O,{modelValue:l.contentForm.duration,"onUpdate:modelValue":t[14]||(t[14]=a=>l.contentForm.duration=a),min:0,max:120,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:12},{default:o(()=>[e(p,{label:"å°é¢å›¾URL"},{default:o(()=>[e(c,{modelValue:l.contentForm.cover_image,"onUpdate:modelValue":t[15]||(t[15]=a=>l.contentForm.cover_image=a),placeholder:"å¯é€‰"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const ve=ee(ie,[["render",_e],["__scopeId","data-v-315ffe2e"]]);export{ve as default};
