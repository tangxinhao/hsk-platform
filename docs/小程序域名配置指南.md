# 小程序域名配置指南

## 问题说明

根据微信小程序的要求：
1. **不能使用 IP 地址**：必须使用已备案的域名
2. **必须使用 HTTPS**：正式环境不允许 HTTP

## 当前状态

- ❌ `http://118.190.106.159` - 不能使用（IP地址 + HTTP）
- ✅ `https://tangxinhao.online` - 需要等域名备案完成后使用

## 解决方案（域名备案完成后执行）

### 步骤 1：配置 SSL 证书

在服务器上执行以下命令获取 Let's Encrypt 证书：

```bash
# 进入项目目录
cd /path/to/your/project

# 使用 certbot 获取证书（需要域名已解析到服务器）
docker run -it --rm \
  -v $(pwd)/certbot/www:/var/www/certbot \
  -v $(pwd)/certbot/conf:/etc/letsencrypt \
  certbot/certbot certonly \
  --webroot \
  --webroot-path=/var/www/certbot \
  --email your-email@example.com \
  --agree-tos \
  --no-eff-email \
  -d tangxinhao.online \
  -d www.tangxinhao.online
```

### 步骤 2：启用 Nginx HTTPS 配置

编辑 `nginx/conf.d/default.conf`，取消注释 HTTPS 配置部分（第 90-171 行），并注释掉临时的 HTTP 配置。

### 步骤 3：重启 Nginx

```bash
docker restart hsk-nginx
```

### 步骤 4：更新小程序代码

修改 `mini-program/app.js`：

```javascript
apiBaseUrl: 'https://tangxinhao.online/api',
```

### 步骤 5：在微信后台配置域名

1. 登录 [微信公众平台](https://mp.weixin.qq.com)
2. 进入：**开发** → **开发管理** → **开发设置**
3. 找到 **服务器域名** → 点击 **修改**
4. 在 **request合法域名** 中添加：
   ```
   https://tangxinhao.online
   ```
5. 点击 **保存并提交**

## 临时测试方案（仅开发工具）

如果需要在开发工具中测试，可以：
1. 在微信开发者工具中，点击右上角 **详情**
2. 勾选 **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**
3. 这样可以在开发工具中使用 HTTP 和 IP 地址测试

**注意**：此设置仅对开发工具有效，正式版小程序必须使用已备案的 HTTPS 域名。
