# 最终解决方案 - 检查证书文件

## 问题确认

- ✅ 配置已加载（nginx -T 显示 HTTPS server 块）
- ❌ 但容器内没有监听 443 端口
- ❌ 错误日志为空

这说明 Nginx 在启动 HTTPS server 时因为证书问题失败了，但错误没有记录。

## 最终排查步骤

### 步骤 1：检查证书文件格式（最关键）

```bash
# 检查证书格式
docker exec hsk-nginx openssl x509 -in /etc/nginx/ssl/tangxinhao.online/cert.pem -text -noout 2>&1

# 检查私钥格式
docker exec hsk-nginx openssl rsa -in /etc/nginx/ssl/tangxinhao.online/cert.key -check -noout 2>&1
```

如果这两个命令有错误，说明证书文件有问题。

### 步骤 2：以前台模式启动 Nginx 查看详细输出

```bash
# 停止当前容器
docker stop hsk-nginx

# 以前台模式启动，查看所有输出
docker run --rm -it \
  -p 443:443 \
  -v /home/hsk/nginx/conf.d:/etc/nginx/conf.d:ro \
  -v /home/hsk/ssl:/etc/nginx/ssl:ro \
  nginx:alpine nginx -g "daemon off;"
```

这样可以看到 Nginx 启动时的所有输出，包括任何证书错误。

### 步骤 3：检查证书文件权限

```bash
# 检查权限
docker exec hsk-nginx ls -l /etc/nginx/ssl/tangxinhao.online/

# 如果权限不对，修改主机上的文件权限
chmod 644 /home/hsk/ssl/tangxinhao.online/cert.pem
chmod 600 /home/hsk/ssl/tangxinhao.online/cert.key
```

### 步骤 4：如果证书文件有问题，重新下载

如果证书格式有问题，需要从阿里云重新下载证书文件。

## 快速诊断

执行这些命令：

```bash
# 1. 检查证书格式
docker exec hsk-nginx openssl x509 -in /etc/nginx/ssl/tangxinhao.online/cert.pem -text -noout 2>&1 | head -5

# 2. 检查私钥格式
docker exec hsk-nginx openssl rsa -in /etc/nginx/ssl/tangxinhao.online/cert.key -check -noout 2>&1

# 3. 检查文件权限
docker exec hsk-nginx ls -l /etc/nginx/ssl/tangxinhao.online/
```

把结果发给我，我就能确定问题所在。
