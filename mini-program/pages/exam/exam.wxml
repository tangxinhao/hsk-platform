<!-- 考试进行中 -->
<view class="exam-page">
  <!-- 顶部计时器 -->
  <view class="exam-header">
    <text class="timer">⏰ {{remainingTime}}</text>
    <text class="progress">{{currentIndex + 1}}/{{totalQuestions}}</text>
  </view>

  <!-- 题目内容（复用练习页面的样式） -->
  <view class="question-content" wx:if="{{currentQuestion}}">
    <view class="type-tag">{{currentQuestion.type_display}}</view>
    
    <!-- 音频 -->
    <view class="audio-section" wx:if="{{currentQuestion.audio_url}}">
      <view class="audio-player" bindtap="toggleAudio">
        <text class="audio-icon">{{isPlaying ? '⏸️' : '▶️'}}</text>
        <text class="audio-text">点击播放音频</text>
      </view>
    </view>

    <!-- 题目 -->
    <view class="question-text">
      <text>{{currentQuestion.content}}</text>
    </view>

    <!-- 选项 -->
    <view class="options-list" wx:if="{{options.length > 0}}">
      <view 
        class="option-item {{(item.isImage && answers[currentIndex] === item.letter) || (!item.isImage && answers[currentIndex] === item.value) ? 'selected' : ''}} {{item.isImage ? 'has-image' : ''}}"
        wx:for="{{options}}"
        wx:key="index"
        bindtap="selectAnswer"
        data-value="{{item.value}}"
        data-letter="{{item.letter}}"
        data-index="{{index}}"
      >
        <text class="option-label">{{item.letter}}</text>
        <!-- 如果是图片URL，显示图片 -->
        <image wx:if="{{item.isImage}}" class="option-image" src="{{item.value}}" mode="aspectFit" lazy-load></image>
        <!-- 否则显示文字 -->
        <text wx:else class="option-text">{{item.value}}</text>
      </view>
    </view>

    <!-- 输入框（用于填空题、写作题等） -->
    <view class="answer-input-section" wx:if="{{options.length === 0}}">
      <textarea 
        class="answer-input" 
        placeholder="请输入您的答案..."
        value="{{currentAnswerText}}"
        bindinput="onAnswerInput"
        maxlength="500"
        auto-height
        show-confirm-bar="{{false}}"
      />
      <view class="input-hint">
        <text class="char-count">{{currentAnswerLength}}/500</text>
      </view>
    </view>
  </view>

  <!-- 底部导航 -->
  <view class="exam-footer">
    <button class="nav-btn" wx:if="{{currentIndex > 0}}" bindtap="prevQuestion">上一题</button>
    <button class="nav-btn primary" bindtap="nextQuestion">
      {{currentIndex < totalQuestions - 1 ? '下一题' : '交卷'}}
    </button>
  </view>
</view>
