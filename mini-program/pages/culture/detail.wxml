<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-wrapper">
    <van-loading size="40rpx" vertical>åŠ è½½ä¸­...</van-loading>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-wrapper">
    <van-empty description="{{errorMsg}}" />
    <van-button type="primary" size="small" bind:tap="onPullDownRefresh">é‡æ–°åŠ è½½</van-button>
  </view>

  <!-- å†…å®¹å±•ç¤º -->
  <view wx:else>
    <!-- å°é¢å›¾ç‰‡ -->
    <image 
      wx:if="{{content.cover_image}}" 
      class="cover" 
      src="{{content.cover_image}}" 
      mode="aspectFill"
      bind:tap="previewImage"
      data-url="{{content.cover_image}}"
    />

    <!-- æ ‡é¢˜å’ŒåŸºæœ¬ä¿¡æ¯ -->
    <view class="header-section">
      <view class="header-top">
        <view class="header-content-wrapper">
          <view class="title">{{displayTitle}}</view>
          <view class="subtitle" wx:if="{{displaySubtitle}}">
            {{displaySubtitle}}
          </view>
        </view>
        <language-switcher class="detail-lang-btn"></language-switcher>
      </view>
      <view class="meta">
        <text class="meta-item">{{displayCategory}}</text>
        <text class="meta-divider">|</text>
        <text class="meta-item">{{displayLevel}}</text>
        <text class="meta-divider" wx:if="{{content.view_count}}">|</text>
        <text class="meta-item" wx:if="{{content.view_count}}">{{viewText}} {{content.view_count}}</text>
      </view>
    </view>

    <!-- å¦‚æœæ˜¯å…«å¤§èœç³»ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ -->
    <view wx:if="{{isCuisine && cuisineDetail}}" class="cuisine-detail">
      
      <!-- å¯¼èˆªæ ‡ç­¾ -->
      <view class="section-tabs">
        <view 
          wx:for="{{sections}}" 
          wx:key="index"
          class="tab-item {{activeSection === index ? 'active' : ''}}"
          bind:tap="switchSection"
          data-index="{{index}}"
        >
          {{item}}
        </view>
      </view>

      <!-- ç®€ä»‹ -->
      <view wx:if="{{activeSection === 0}}" class="content-section">
        <view class="section-title">
          <text class="icon">ğŸ“–</text>
          <text>ç®€ä»‹</text>
        </view>
        <view class="section-content">
          <text class="description">{{cuisineDetail.description}}</text>
          <view class="info-item">
            <text class="label">å‘æºåœ°ï¼š</text>
            <text class="value">{{cuisineDetail.origin}}</text>
          </view>
        </view>
      </view>

      <!-- ç‰¹ç‚¹ -->
      <view wx:if="{{activeSection === 1}}" class="content-section">
        <view class="section-title">
          <text class="icon">â­</text>
          <text>èœç³»ç‰¹ç‚¹</text>
        </view>
        <view class="section-content">
          <view 
            wx:for="{{cuisineDetail.characteristics}}" 
            wx:key="index"
            class="characteristic-item"
          >
            <text class="bullet">â€¢</text>
            <text class="text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- åèœ -->
      <view wx:if="{{activeSection === 2}}" class="content-section">
        <view class="section-title">
          <text class="icon">ğŸ½ï¸</text>
          <text>ä»£è¡¨åèœ</text>
        </view>
        <view class="section-content">
          <view 
            wx:for="{{cuisineDetail.famous_dishes}}" 
            wx:key="name"
            class="dish-card"
          >
            <view class="dish-name">{{item.name}}</view>
            <view class="dish-desc">{{item.desc}}</view>
          </view>
        </view>
      </view>

      <!-- æ–‡åŒ– -->
      <view wx:if="{{activeSection === 3}}" class="content-section">
        <view class="section-title">
          <text class="icon">ğŸ›ï¸</text>
          <text>æ–‡åŒ–å†…æ¶µ</text>
        </view>
        <view class="section-content">
          <text class="culture-text">{{cuisineDetail.culture}}</text>
        </view>
      </view>

      <!-- å°è´´å£« -->
      <view wx:if="{{activeSection === 4}}" class="content-section">
        <view class="section-title">
          <text class="icon">ğŸ’¡</text>
          <text>å“å°å°è´´å£«</text>
        </view>
        <view class="section-content">
          <view class="tips-box">
            <text class="tips-text">{{cuisineDetail.tips}}</text>
          </view>
        </view>
      </view>

    </view>

    <!-- æ™®é€šæ–‡ç« å†…å®¹ -->
    <view wx:else class="article-content">
      <rich-text nodes="{{content.content}}"></rich-text>
    </view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="action-bar">
      <view class="action-buttons">
        <view class="action-btn" bind:tap="toggleLike">
          <van-icon name="{{isLiked ? 'like' : 'like-o'}}" size="48rpx" color="{{isLiked ? '#ee0a24' : '#666'}}" />
          <text class="action-text {{isLiked ? 'active' : ''}}">
            {{isLiked ? 'å·²ç‚¹èµ' : 'ç‚¹èµ'}}
          </text>
        </view>
        <view class="action-btn" bind:tap="toggleFavorite">
          <van-icon name="{{isFavorite ? 'star' : 'star-o'}}" size="48rpx" color="{{isFavorite ? '#ff976a' : '#666'}}" />
          <text class="action-text {{isFavorite ? 'active' : ''}}">
            {{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}
          </text>
        </view>
        <button open-type="share" class="action-btn share-btn">
          <van-icon name="share-o" size="48rpx" color="#666" />
          <text class="action-text">åˆ†äº«</text>
        </button>
      </view>
    </view>

  </view>
</view> 